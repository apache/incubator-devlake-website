<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://devlake.apache.org/blog</id>
    <title>Apache DevLake (Incubating) Blog</title>
    <updated>2022-05-20T00:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://devlake.apache.org/blog"/>
    <subtitle>Apache DevLake (Incubating) Blog</subtitle>
    <icon>https://devlake.apache.org/img/logo.svg</icon>
    <entry>
        <title type="html"><![CDATA[å¦‚ä½•è´¡çŒ®issues]]></title>
        <id>how-to-contribute-to-issues</id>
        <link href="https://devlake.apache.org/blog/how-to-contribute-to-issues"/>
        <updated>2022-05-20T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[ä¸Šå‘¨(2022-05-12)ï¼Œæˆ‘ä»¬ä»¥å…ˆåˆ°å…ˆå¾—çš„æ–¹å¼ä¸ºå¤§å®¶åˆ—å‡ºäº†ä¸¤ä¸ª"good first issue"ã€‚]]></summary>
        <content type="html"><![CDATA[<p>ä¸Šå‘¨(2022-05-12)ï¼Œæˆ‘ä»¬ä»¥å…ˆåˆ°å…ˆå¾—çš„æ–¹å¼ä¸ºå¤§å®¶åˆ—å‡ºäº†ä¸¤ä¸ª"good first issue"ã€‚
è¿™å¾ˆæœ‰è¶£ï¼Œå®ƒä»¬å‡ ä¹ç«‹åˆ»å°±è¢«æ‹¿èµ°äº†......
ä½†å¯¹äºé‚£äº›æœ‰å…´è¶£ä½†æ²¡æœ‰å¾—åˆ°çš„äººæ¥è¯´å¯èƒ½å°±ä¸é‚£ä¹ˆæœ‰è¶£äº†ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="æ‰€ä»¥">æ‰€ä»¥...<a class="hash-link" href="#æ‰€ä»¥" title="Direct link to heading">â€‹</a></h3><p>æˆ‘ä»¬å†³å®šï¼Œä¸å†æœ‰ç«äº‰ï¼Œä½ å¯ä»¥ä»æˆ‘ä»¬çš„github issue pagesä¸­æŒ‘é€‰ä½ å–œæ¬¢çš„issueã€‚å¦‚æœæ²¡æœ‰äº†ï¼Œç”šè‡³å¯ä»¥åˆ›å»ºä½ è‡ªå·±çš„ã€‚
æˆ‘ä»¬æ¯•ç«Ÿæ˜¯ç¤¾åŒºï¼</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="æ€ä¹ˆåšå‘¢è¿™å¾ˆç®€å•">æ€ä¹ˆåšå‘¢ï¼Ÿè¿™å¾ˆç®€å•!<a class="hash-link" href="#æ€ä¹ˆåšå‘¢è¿™å¾ˆç®€å•" title="Direct link to heading">â€‹</a></h3><p>è¿›å…¥æˆ‘ä»¬çš„<a href="https://github.com/apache/incubator-devlake/issues?q=is%3Aopen+is%3Aissue+label%3A%22good+first+issue%22" target="_blank" rel="noopener noreferrer">é—®é¢˜é¡µé¢</a>ï¼Œç„¶åç‚¹å‡»è¿™é‡Œã€‚æˆ‘ä»¬æ‰€æœ‰çš„Good First Issueéƒ½åˆ—åœ¨è¿™é‡Œ!
<img loading="lazy" alt="good first issue" src="/assets/images/issue_page_screenshot-4aa3f48811d5bc6aa1a36ce71727344c.png" width="1320" height="266" class="img_E7b_"></p><ul><li><p>é¦–å…ˆï¼Œå¯»æ‰¾ç°æœ‰çš„issuesï¼Œæ‰¾åˆ°ä¸€ä¸ªä½ å–œæ¬¢çš„ã€‚
ä½ å¯ä»¥é€šè¿‡è¯„è®º"I'll take it!"æ¥é¢„è®¢å®ƒã€‚
æ¥ä¸‹æ¥ä½ å¯ä»¥å†™ä¸€ä»½â€œæ”»ç•¥â€ï¼Œä»¥å±•ç¤ºä½ å¯¹é—®é¢˜çš„ç†è§£å’Œä½ å°†é‡‡å–ä»€ä¹ˆæ ·çš„æ­¥éª¤æ¥è§£å†³è¿™ä¸ªissueï¼Œç„¶åå¼€å§‹Codingã€‚</p></li><li><p>å¦‚æœæ²¡æœ‰GFIäº†æ€ä¹ˆåŠï¼Ÿåˆ›é€ ä½ è‡ªå·±çš„issue! ç°åœ¨ï¼Œé€šè¿‡æŸ¥çœ‹æˆ‘ä»¬çš„ä»£ç åº“ã€‚
ä½ è‚¯å®šèƒ½å‘ç°å¾ˆå¤šé—®é¢˜ï¼Œæ¯”å¦‚æ–‡æ¡£ã€å•å…ƒæµ‹è¯•ï¼Œç”šè‡³æ˜¯é”™å­—ã€‚
æŠŠä½ è§‰å¾—ä¸å¯¹çš„åœ°æ–¹æå‡ºæ¥ï¼Œæˆ‘ä»¬ä¼šéªŒè¯å®ƒæ˜¯å¦å¿…è¦ï¼Œ
ç„¶åä½ å°±å¯ä»¥å¼€å§‹Codingäº†ã€‚</p></li><li><p>æœ€åï¼Œä½ å¯èƒ½ä¼šé—®ï¼Œæˆ‘ä¸ºä»€ä¹ˆè¦è´¹å°½å¿ƒæ€ä¸ºä½ å†™ä»£ç ï¼Ÿ
ä¸ä¸ä¸ï¼Œä½ ä¸æ˜¯ä¸ºæˆ‘ä»¬å†™ä»£ç ï¼Œä½ æ˜¯ä¸ºç¤¾åŒºé‡Œçš„æ¯ä¸ªäººå†™ä»£ç ï¼Œä½ æ˜¯ä¸ºè‡ªå·±å†™ä»£ç ã€‚
ä¸ºäº†æé«˜ä½ çš„æŠ€èƒ½ï¼Œä¸ºäº†å­¦ä¹ å¦‚ä½•ä¸ä»–äººåˆä½œã€‚è€Œå¯¹äºé‚£äº›åšå‡ºé‡å¤§è´¡çŒ®çš„äººï¼Œ
æˆ‘ä»¬ä¸ºæ‚¨æä¾›ä¸€ä¸ªApache Committerçš„å¸­ä½ï¼Œç”šè‡³æ˜¯PPMCï¼</p></li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="å°±è¿™äº›äº†æœ‰ä»»ä½•é—®é¢˜è¯·éšæ—¶æå‡ºç¼–ç å¿«ä¹">å°±è¿™äº›äº†ï¼Œæœ‰ä»»ä½•é—®é¢˜è¯·éšæ—¶æå‡ºã€‚ç¼–ç å¿«ä¹ï¼<a class="hash-link" href="#å°±è¿™äº›äº†æœ‰ä»»ä½•é—®é¢˜è¯·éšæ—¶æå‡ºç¼–ç å¿«ä¹" title="Direct link to heading">â€‹</a></h3>]]></content>
        <author>
            <name>Klesh Wong</name>
            <uri>https://kleshwong.com</uri>
        </author>
        <category label="devlake" term="devlake"/>
        <category label="apache" term="apache"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Apache Incubator Welcomes DevLake, A Dev-Data Platform Serving Developers]]></title>
        <id>apache-welcomes-devlake</id>
        <link href="https://devlake.apache.org/blog/apache-welcomes-devlake"/>
        <updated>2022-05-18T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[We are excited to share today that the Apache Software Foundation (ASF) voted to make DevLake an officially supported project of the Apache Incubator.]]></summary>
        <content type="html"><![CDATA[<p>We are excited to share today that the Apache Software Foundation (ASF) voted to make DevLake an officially supported project of the Apache Incubator.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="what-is-devlake">What is DevLake?<a class="hash-link" href="#what-is-devlake" title="Direct link to heading">â€‹</a></h3><p>Launched in December of 2021, <a href="https://github.com/apache/incubator-devlake" target="_blank" rel="noopener noreferrer">Apache DevLake</a> is an open-source dev data platform that ingests, analyzes, and visualizes the fragmented data in developer tools. </p><p>Software development is complex, requiring many tools and processes, and as a result creates a storm of data scattered across tools in many formats. This makes it difficult to organize, query, and make sense of. We built Apache DevLake, to make it easy to make sense of this rich data and to translate it into actionable insights.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="apache-devlakes-key-features">Apache DevLake's key features:<a class="hash-link" href="#apache-devlakes-key-features" title="Direct link to heading">â€‹</a></h3><ul><li>DevOps data collection across software development lifecycle (SDLC) to connect data islands</li><li>Standardized data models with out-of-the-box metrics and customizable dashboards</li><li>Flexible plugin system for user-defined data integration and transformation</li></ul><p>Below is the architecture of Apache DevLake:
<img loading="lazy" alt="architecture" src="/assets/images/0.11-architecture-diagram-f422e47efad0b84f72eb3bc51c7d1f1b.jpg" width="2143" height="1182" class="img_E7b_"></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="why-join-apache-incubator">Why join Apache Incubator?<a class="hash-link" href="#why-join-apache-incubator" title="Direct link to heading">â€‹</a></h3><p>First and foremost, we firmly believe in Apache's principle of "Community over Code" and <a href="https://www.apache.org/theapacheway/index.html" target="_blank" rel="noopener noreferrer">"The Apache Way"</a>. We look forward to building a vibrant, inclusive, and diverse community under the guidance of our mentors through the incubator journey.</p><p>We also feel that the Apache community has one of the strongest ecosystems when it comes to data-oriented open-source projects. </p><p>Last and not least, the support and enthusiasm of the Apache community and mentors made it clear to us that this would be a place where we can truly evolve and nurture Apache DevLake.</p><p>In the months leading up to DevLake's acceptance, our mentors provided guidance and suggestions instrumental to making this important moment a reality. We want to take this opportunity to thank and acknowledge them: </p><ul><li><p><strong><a href="https://github.com/WillemJiang" target="_blank" rel="noopener noreferrer">Willem Ning Jiang</a></strong>: Apache DevLake Champion; ASF Member &amp; Board Director</p></li><li><p><strong><a href="https://github.com/terrymanu" target="_blank" rel="noopener noreferrer">Liang Zhang</a></strong>: Founder &amp; CEO of SphereEx; ASF Member, Founder &amp; PMC Chair of Apache ShardingSphere</p></li><li><p><strong><a href="https://github.com/dailidong" target="_blank" rel="noopener noreferrer">Lidong Dai</a></strong>: ASF Member; Apache DolphinScheduler PMC Chair</p></li><li><p><strong><a href="https://github.com/sijie" target="_blank" rel="noopener noreferrer">Sijie Guo</a></strong>: ASF Member, PMC member of Apache Pulsar; Founder &amp; CEO of StreamNative</p></li><li><p><strong><a href="https://github.com/felixcheung" target="_blank" rel="noopener noreferrer">Felix Cheung</a></strong>: ASF Member, PMC on Spark, Superset, Yunikorn, Zeppelin, Pinot, and Incubator. SVP of Engineering at SafeGraph.</p></li><li><p><strong><a href="https://github.com/jbonofre" target="_blank" rel="noopener noreferrer">Jean-Baptiste OnofrÃ©</a></strong>: ASF Member, Karaf PMC Chair, PMC on ActiveMQ, Archiva, Aries, Beam, Brooklyn, Camel, Carbondata, Felix, Incubator, and <a href="http://people.apache.org/committer-index.html" target="_blank" rel="noopener noreferrer">many more</a>.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="apache-devlake-future-roadmap">Apache DevLake Future Roadmap<a class="hash-link" href="#apache-devlake-future-roadmap" title="Direct link to heading">â€‹</a></h3><ul><li>Enhance system scalability and performance in large-scale data scenarios.</li><li>Integrate more data sources and tools (JIRA, GitHub, GitLab, and Jenkins are already supported.)</li><li>Enable support for OLAP databases, providing users with more choices.</li><li>Provide more scenario-specific, out-of-the-box dashboards and templates reflecting best practices and well-known methodologies to improve usability.</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="join-us">Join us!<a class="hash-link" href="#join-us" title="Direct link to heading">â€‹</a></h3><p>We invite developers and those passionate about data-driven engineering to 'dive into the lake' with us, and welcome contributions of all kinds.
Join us on Slack and at our weekly open source community meetupsğŸ¥³</p><p><strong>Apache DevLake (Incubating) Links:</strong></p><ul><li>GitHub:  <a href="https://github.com/apache/incubator-devlake" target="_blank" rel="noopener noreferrer">https://github.com/apache/incubator-devlake</a></li><li>Official Website: <a href="https://devlake.apache.org/" target="_blank" rel="noopener noreferrer">https://devlake.apache.org/</a></li><li>Slack:   <a href="https://join.slack.com/t/devlake-io/shared_invite/zt-18uayb6ut-cHOjiYcBwERQ8VVPZ9cQQw" target="_blank" rel="noopener noreferrer">https://join.slack.com/t/devlake-io/shared_invite/zt-18uayb6ut-cHOjiYcBwERQ8VVPZ9cQQw</a></li><li>Podling Websiteï¼š<a href="https://incubator.apache.org/projects/devlake.html" target="_blank" rel="noopener noreferrer">https://incubator.apache.org/projects/devlake.html</a></li></ul>]]></content>
        <author>
            <name>Maxim Wheatley</name>
            <uri>https://github.com/MaximDub</uri>
        </author>
        <category label="Devlake" term="Devlake"/>
        <category label="Apache" term="Apache"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Apache DevLakeæ˜¯æ€ä¹ˆè·‘èµ·æ¥çš„]]></title>
        <id>how-apache-devlake-runs</id>
        <link href="https://devlake.apache.org/blog/how-apache-devlake-runs"/>
        <updated>2022-05-18T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Apache DevLake æ˜¯ä¸€ä¸ªDevOpsæ•°æ®æ”¶é›†å’Œæ•´åˆå·¥å…·ï¼Œé€šè¿‡ Grafana ä¸ºå¼€å‘å›¢é˜Ÿå‘ˆç°å‡ºä¸åŒé˜¶æ®µçš„æ•°æ®ï¼Œè®©å›¢é˜Ÿèƒ½å¤Ÿä»¥æ•°æ®ä¸ºé©±åŠ¨æ”¹è¿›å¼€å‘æµç¨‹ã€‚]]></summary>
        <content type="html"><![CDATA[<p><a href="https://github.com/apache/incubator-devlake" target="_blank" rel="noopener noreferrer">Apache DevLake</a> æ˜¯ä¸€ä¸ªDevOpsæ•°æ®æ”¶é›†å’Œæ•´åˆå·¥å…·ï¼Œé€šè¿‡ Grafana ä¸ºå¼€å‘å›¢é˜Ÿå‘ˆç°å‡ºä¸åŒé˜¶æ®µçš„æ•°æ®ï¼Œè®©å›¢é˜Ÿèƒ½å¤Ÿä»¥æ•°æ®ä¸ºé©±åŠ¨æ”¹è¿›å¼€å‘æµç¨‹ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="apache-devlake-æ¶æ„æ¦‚è¿°">Apache DevLake æ¶æ„æ¦‚è¿°<a class="hash-link" href="#apache-devlake-æ¶æ„æ¦‚è¿°" title="Direct link to heading">â€‹</a></h3><ul><li>å·¦è¾¹æ˜¯<a href="https://devlake.apache.org/docs/DataModels/DataSupport" target="_blank" rel="noopener noreferrer">å¯é›†æˆçš„DevOpsæ•°æ®æ’ä»¶</a>ï¼Œç›®å‰å·²æœ‰çš„æ’ä»¶åŒ…æ‹¬ Githubï¼ŒGitlabï¼ŒJIRAï¼ŒJenkinsï¼ŒTapdï¼ŒFeishu ä»¥åŠæ€ç é€¸ä¸»æ‰“çš„ä»£ç åˆ†æå¼•æ“</li><li>ä¸­é—´æ˜¯ä¸»ä½“æ¡†æ¶ï¼Œé€šè¿‡ä¸»ä½“æ¡†æ¶è¿è¡Œæ’ä»¶ä¸­çš„å­ä»»åŠ¡ï¼Œå®Œæˆæ•°æ®çš„æ”¶é›†ï¼Œæ‰©å±•ï¼Œå¹¶è½¬æ¢åˆ°é¢†åŸŸå±‚ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ config-ui æˆ–è€… api è°ƒç”¨çš„å½¢å¼æ¥è§¦å‘ä»»åŠ¡</li><li>RMDBS ç›®å‰æ”¯æŒ Mysql å’Œ PostgreSQLï¼ŒåæœŸè¿˜ä¼šç»§ç»­æ”¯æŒæ›´å¤šçš„æ•°æ®åº“</li><li>Grafana å¯ä»¥é€šè¿‡sqlè¯­å¥ç”Ÿæˆå›¢é˜Ÿéœ€è¦çš„å„ç§æ•°æ®</li></ul><p><img loading="lazy" alt="Generated" src="/assets/images/Aspose.Words.093a76ac-457b-4498-a472-7dbea580bca9.001-9fe996eee294ce1843bc3f126a1a7b89.png" width="567" height="310" class="img_E7b_"></p><blockquote><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±è¯¦ç»†èŠä¸€èŠç³»ç»Ÿæ˜¯æ€ä¹ˆè·‘èµ·æ¥çš„ã€‚</p></blockquote><h3 class="anchor anchorWithStickyNavbar_mojV" id="ç³»ç»Ÿå¯åŠ¨">ç³»ç»Ÿå¯åŠ¨<a class="hash-link" href="#ç³»ç»Ÿå¯åŠ¨" title="Direct link to heading">â€‹</a></h3><p>åœ¨æˆ‘ä»¬çš„ golang ç¨‹åºå¯åŠ¨ä¹‹å‰ï¼Œé¦–å…ˆä¼šè‡ªåŠ¨è°ƒç”¨å„ä¸ª package çš„ init() æ–¹æ³•ï¼Œæˆ‘ä»¬ä¸»è¦çœ‹çœ‹services åŒ…çš„è½½å…¥ï¼Œä¸‹é¢çš„ä»£ç æœ‰è¯¦ç»†æ³¨é‡Šï¼š</p><div class="codeBlockContainer_I0IT language-go theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-go codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> err </span><span class="token builtin">error</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// è·å–é…ç½®ä¿¡æ¯</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cfg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// è·å–åˆ°æ•°æ®åº“</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> runner</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewGormDb</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cfg</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Global</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Nested</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"db"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// é…ç½®æ—¶åŒº</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">location </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> cron</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">WithLocation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">UTC</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// åˆ›å»ºå®šæ—¶ä»»åŠ¡ç®¡ç†å™¨</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cronManager </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cron</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">New</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">location</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">panic</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// åˆå§‹åŒ–æ•°æ®è¿ç§»</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">migration</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">db</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// æ³¨å†Œæ¡†æ¶çš„æ•°æ®è¿ç§»è„šæœ¬</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">migrationscripts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">RegisterAll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// è½½å…¥æ’ä»¶ï¼Œä»cfg.GetString("PLUGIN_DIR")è·å–åˆ°çš„æ–‡ä»¶å¤¹ä¸­è½½å…¥æ‰€æœ‰.soæ–‡ä»¶ï¼Œåœ¨LoadPluginsæ–¹æ³•ä¸­ï¼Œå…·ä½“æ¥è®²ï¼Œé€šè¿‡è°ƒç”¨runner.LoadPluginså°†pluginName:PluginMetaé”®å€¼å¯¹å­˜å…¥åˆ°core.pluginsä¸­</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">err </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> runner</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">LoadPlugins</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cfg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"PLUGIN_DIR"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cfg</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Global</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Nested</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"plugin"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">panic</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// æ‰§è¡Œæ•°æ®è¿ç§»è„šæœ¬ï¼Œå®Œæˆæ•°æ®åº“æ¡†æ¶å±‚å„ä¸ªè¡¨çš„åˆå§‹åŒ–</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">err </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> migration</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Execute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Background</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">panic</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// call service init</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">pipelineServiceInit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="devlakeçš„ä»»åŠ¡æ‰§è¡ŒåŸç†">DevLakeçš„ä»»åŠ¡æ‰§è¡ŒåŸç†<a class="hash-link" href="#devlakeçš„ä»»åŠ¡æ‰§è¡ŒåŸç†" title="Direct link to heading">â€‹</a></h3><p><strong>Pipelineçš„è¿è¡Œæµç¨‹</strong></p><p>åœ¨è®²è§£Pipelineæµç¨‹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆè§£é‡Šä¸€ä¸‹<a href="https://devlake.apache.org/docs/Glossary#blueprints" target="_blank" rel="noopener noreferrer">Blueprint</a>ã€‚</p><p>Blueprintæ˜¯ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼ŒåŒ…å«äº†éœ€è¦æ‰§è¡Œçš„å­ä»»åŠ¡ä»¥åŠæ‰§è¡Œè®¡åˆ’ã€‚Blueprint çš„æ¯ä¸€æ¬¡æ‰§è¡Œè®°å½•æ˜¯ä¸€æ¡Historical Runï¼ˆä¹Ÿç§°ä¸º Pipelineï¼‰ï¼Œä»£è¡¨ DevLake ä¸€æ¬¡è§¦å‘ï¼Œé€šè¿‡ä¸€ä¸ªæˆ–å¤šä¸ªæ’ä»¶ï¼Œå®Œæˆäº†ä¸€ä¸ªæˆ–å¤šä¸ªæ•°æ®æ”¶é›†è½¬æ¢çš„ä»»åŠ¡ã€‚</p><p><img loading="lazy" alt="Generated" src="/assets/images/Aspose.Words.093a76ac-457b-4498-a472-7dbea580bca9.002-40065677c2b00df89eeaac1d9512f286.png" width="567" height="263" class="img_E7b_"></p><p>ä»¥ä¸‹æ˜¯ Pipeline è¿è¡Œæµç¨‹å›¾ï¼š</p><p><img loading="lazy" alt="Generated" src="/assets/images/Aspose.Words.093a76ac-457b-4498-a472-7dbea580bca9.003-d07631a740cb5b056d15a35627afef80.png" width="344" height="515" class="img_E7b_"></p><p>ä¸€ä¸ªpipelineåŒ…å«ä¸€ä¸ªäºŒç»´æ•°ç»„tasksï¼Œä¸»è¦æ˜¯ä¸ºäº†ä¿è¯ä¸€ç³»åˆ—ä»»åŠ¡æŒ‰é¢„è®¾é¡ºåºæ‰§è¡Œã€‚å¦‚æœä¸‹å›¾ä¸­çš„ Stage3 çš„æ’ä»¶éœ€è¦ä¾èµ–å…¶ä»–æ’ä»¶å‡†å¤‡æ•°æ®ï¼ˆä¾‹å¦‚ refdiff çš„è¿è¡Œéœ€è¦ä¾èµ– gitextractor å’Œ githubï¼Œæ•°æ®æºä¸æ’ä»¶çš„æ›´å¤šä¿¡æ¯è¯·çœ‹<a href="https://devlake.apache.org/docs/DataModels/DataSupport" target="_blank" rel="noopener noreferrer">æ–‡æ¡£</a>ï¼‰ï¼Œé‚£ä¹ˆ Stage 3 å¼€å§‹æ‰§è¡Œæ—¶ï¼Œéœ€è¦ä¿è¯å…¶ä¾èµ–é¡¹å·²åœ¨ Stage1 å’Œ Stage2 æ‰§è¡Œå®Œæˆï¼š</p><p><img loading="lazy" alt="Generated" src="/assets/images/Aspose.Words.093a76ac-457b-4498-a472-7dbea580bca9.004-a6a550c4f00b232abc7b28e30738be09.png" width="567" height="238" class="img_E7b_"></p><p><strong>Taskçš„è¿è¡Œæµç¨‹</strong></p><p>åœ¨stage1ï¼Œstage2ï¼Œstage3ä¸­çš„å„æ’ä»¶ä»»åŠ¡éƒ½æ˜¯å¹¶è¡Œæ‰§è¡Œï¼š</p><p><img loading="lazy" alt="Generated" src="/assets/images/Aspose.Words.093a76ac-457b-4498-a472-7dbea580bca9.005-4d14031484d1272b4be8d7ff2f08d2a2.png" width="304" height="501" class="img_E7b_"></p><p><strong>æ¥ä¸‹æ¥å°±æ˜¯é¡ºåºæ‰§è¡Œæ’ä»¶ä¸­çš„å­ä»»åŠ¡</strong></p><p><img loading="lazy" alt="Generated" src="/assets/images/Aspose.Words.093a76ac-457b-4498-a472-7dbea580bca9.006-83ed245c2c8d805aca908814f0f0f5f9.png" width="331" height="617" class="img_E7b_"></p><ol><li>RunTask ä¹‹å‰çš„å·¥ä½œéƒ½æ˜¯åœ¨å‡†å¤‡ RunTask æ–¹æ³•éœ€è¦çš„å‚æ•°ï¼Œæ¯”å¦‚ loggerï¼Œdbï¼Œcontext ç­‰ç­‰ã€‚</li><li>RunTask æ–¹æ³•ä¸­ä¸»è¦æ˜¯å¯¹æ•°æ®åº“ä¸­çš„tasksè¿›è¡ŒçŠ¶æ€æ›´æ–°ï¼ŒåŒæ—¶ï¼Œå‡†å¤‡è¿è¡Œæ’ä»¶ä»»åŠ¡çš„ optionsï¼ˆæŠŠä» config-ui ä¼ è¿‡æ¥çš„ json è½¬æˆ map ä¼ åˆ° RunPluginTask ä¸­ï¼‰</li><li>RunPluginTask é¦–å…ˆé€šè¿‡ core.GetPlugin(pluginName) è·å–åˆ°å¯¹åº” <a href="#pm">PluginMeta</a>ï¼Œç„¶åé€šè¿‡ PluginMeta è·å–åˆ° <a href="#pt">PluginTask</a>ï¼Œå†æ‰§è¡Œ RunPluginSubTasks</li></ol><p><strong>æ¯ä¸€ä¸ªæ’ä»¶å­ä»»åŠ¡çš„è¿è¡Œæµç¨‹ï¼ˆæ¶‰åŠåˆ°çš„ interface åŠ func ä¼šåœ¨<a href="#DevLake%E4%B8%AD%E7%9A%84%E9%87%8D%E8%A6%81%E6%8E%A5%E5%8F%A3">ä¸‹ä¸€èŠ‚</a>è¯¦ç»†é˜è¿°ï¼‰</strong></p><p><img loading="lazy" alt="Generated" src="/assets/images/Aspose.Words.093a76ac-457b-4498-a472-7dbea580bca9.007-09a5f7c401dfb5a557b10c3870d103fe.png" width="567" height="214" class="img_E7b_"></p><ol><li>é€šè¿‡è°ƒç”¨SubTaskMetas()è·å–åˆ°æ‰€æœ‰æ’ä»¶æ‰€æœ‰çš„å¯ç”¨å­ä»»åŠ¡<a href="#stm">subtaskMeta</a></li><li>é€šè¿‡<code>options["tasks"]</code>ä»¥åŠsubtaskMetaç»„å»ºéœ€è¦æ‰§è¡Œçš„å­ä»»åŠ¡é›†åˆsubtaskMetas</li><li>è®¡ç®—æ€»å…±å¤šå°‘ä¸ªå­ä»»åŠ¡</li><li>é€šè¿‡<code>helper.NewDefaultTaskContext</code>æ„å»º<a href="#tc">taskCtx</a></li><li>è°ƒç”¨<code>pluginTask.PrepareTaskData</code>æ„å»º<a href="#td">taskData</a>ï¼Œ</li><li>æ¥ä¸‹æ¥è¿­ä»£subtaskMetasé‡Œé¢çš„æ‰€æœ‰å­ä»»åŠ¡<ol><li>é€šè¿‡<code>taskCtx.SubTaskContext(subtaskMeta.Name)</code>è·å–åˆ°å­ä»»åŠ¡çš„<a href="#sc">subtaskCtx</a></li><li>æ‰§è¡Œ<a href="#step"><code>subtaskMeta.EntryPoint(subtaskCtx)</code></a></li></ol></li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="devlakeä¸­çš„é‡è¦æ¥å£">DevLakeä¸­çš„é‡è¦æ¥å£<a class="hash-link" href="#devlakeä¸­çš„é‡è¦æ¥å£" title="Direct link to heading">â€‹</a></h3><ol><li><a id="pm">PluginMeta</a>: åŒ…å«äº†æ’ä»¶æœ€åŸºæœ¬çš„ä¸¤ä¸ªæ–¹æ³•ï¼Œæ‰€æœ‰æ’ä»¶éƒ½éœ€è¦å®ç°ï¼Œç³»ç»Ÿå¯åŠ¨çš„æ—¶å€™å­˜åœ¨core.pluginsä¸­ï¼Œåœ¨æ‰§è¡Œæ’ä»¶ä»»åŠ¡çš„æ—¶å€™é€šè¿‡core.GetPluginè·å–</li></ol><div class="codeBlockContainer_I0IT language-go theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-go codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> PluginMeta </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token function" style="color:#d73a49">Description</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">//PkgPath information will be lost when compiled as plugin(.so), this func will return that info</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token function" style="color:#d73a49">RootPkgPath</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><ol start="2"><li><a id="pt">PluginTask</a>: é€šè¿‡PluginMetaè·å–ï¼Œæ’ä»¶å®ç°è¿™ä¸ªæ–¹æ³•ä¹‹åï¼ŒFrameworkå°±èƒ½ç›´æ¥è¿è¡Œå­ä»»åŠ¡ï¼Œè€Œä¸æ˜¯æ‰”ç»™æ’ä»¶è‡ªå·±å»æ‰§è¡Œï¼Œæœ€å¤§çš„å¥½å¤„å°±æ˜¯æ’ä»¶çš„å­ä»»åŠ¡å®ç°æ›´åŠ ç®€å•ï¼Œåœ¨æ’ä»¶è¿è¡Œå½“ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ›´å®¹æ˜“çš„å»å¹²æ¶‰ï¼ˆæ¯”å¦‚å¢åŠ æ—¥å¿—ç­‰ç­‰ï¼‰</li></ol><div class="codeBlockContainer_I0IT language-go theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-go codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> PluginTask </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// return all available subtasks, framework will run them for you in order</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token function" style="color:#d73a49">SubTaskMetas</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">SubTaskMeta</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// based on task context and user input options, return data that shared among all subtasks</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token function" style="color:#d73a49">PrepareTaskData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">taskCtx TaskContext</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> options </span><span class="token keyword" style="color:#00009f">map</span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">]</span><span class="token keyword" style="color:#00009f">interface</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">interface</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><ol start="3"><li>æ¯ä¸ªæ’ä»¶è¿˜æœ‰ä¸€ä¸ª<a id="td">taskData</a>ï¼Œé‡Œé¢åŒ…å«äº†é…ç½®é€‰é¡¹ï¼ŒapiClientä»¥åŠä¸€äº›æ’ä»¶å…¶å®ƒå±æ€§ï¼ˆæ¯”å¦‚githubæœ‰Repoä¿¡æ¯ï¼‰</li><li><a id="stm">SubTaskMeta</a>: ä¸€ä¸ªå­ä»»åŠ¡çš„å…ƒæ•°æ®ï¼Œæ¯ä¸ªå­ä»»åŠ¡éƒ½ä¼šå®šä¹‰ä¸€ä¸ªSubTaskMeta</li></ol><div class="codeBlockContainer_I0IT language-go theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-go codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> CollectMeetingTopUserItemMeta </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> core</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">SubTaskMeta</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"collectMeetingTopUserItem"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   EntryPoint</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> CollectMeetingTopUserItem</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   EnabledByDefault</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Description</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Collect top user meeting data from Feishu api"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><ol start="5"><li><a id="ec">ExecContext</a>: å®šä¹‰äº†æ‰§è¡Œ(å­)ä»»åŠ¡éœ€è¦çš„æ‰€æœ‰èµ„æº</li><li><a id="stc">SubTaskContext</a>: å®šä¹‰äº†æ‰§è¡Œå­ä»»åŠ¡æ‰€éœ€è¦çš„èµ„æºï¼ˆåŒ…å«äº†ExecContextï¼‰</li><li><a id="tc">TaskContext</a>: å®šä¹‰äº†æ‰§è¡Œæ’ä»¶ä»»åŠ¡æ‰€éœ€è¦çš„èµ„æºï¼ˆåŒ…å«äº†ExecContextï¼‰ã€‚ä¸SubTaskContextçš„åŒºåˆ«åœ¨äºSubTaskContextä¸­çš„TaskContext()æ–¹æ³•å¯ä»¥è¿”å›TaskContextï¼Œè€ŒTaskContextä¸­çš„æ–¹æ³•SubTaskContext(subtask string)æ–¹æ³•å¯ä»¥è¿”å›SubTaskContextï¼Œå­ä»»åŠ¡éš¶å±äºæ’ä»¶ä»»åŠ¡ï¼Œæ‰€ä»¥æŠŠè¿™ä¸¤ä¸ªContextè¿›è¡Œäº†åŒºåˆ†</li><li><a id="step">SubTaskEntryPoint</a>: æ‰€æœ‰çš„æ’ä»¶å­ä»»åŠ¡éƒ½éœ€è¦å®ç°è¿™ä¸ªå‡½æ•°ï¼Œè¿™æ ·æ‰èƒ½ç”±æ¡†æ¶å±‚ç»Ÿä¸€åè°ƒå®‰æ’</li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="åç»­">åç»­<a class="hash-link" href="#åç»­" title="Direct link to heading">â€‹</a></h3><p>è¿™ç¯‡æ–‡ç« ä»‹ç»äº† DevLake çš„æ¶æ„ä»¥åŠè¿è¡Œæµç¨‹ï¼Œè¿˜æœ‰ä¸‰ä¸ªæ ¸å¿ƒ api<!-- -->_<!-- -->collectorã€api<!-- -->_<!-- -->extractor å’Œ data<!-- -->_<!-- -->convertor å°†ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« è¿›è¡Œå‰–æã€‚</p>]]></content>
        <author>
            <name>Warren Chen (é™ˆæ˜ åˆ)</name>
            <uri>https://github.com/warren830</uri>
        </author>
        <category label="devlake" term="devlake"/>
        <category label="apache" term="apache"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[ä½¿ç”¨antså¼•å‘çš„æ­»é”]]></title>
        <id>deadlock-caused-by-using-ants</id>
        <link href="https://devlake.apache.org/blog/deadlock-caused-by-using-ants"/>
        <updated>2022-04-30T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[1. èƒŒæ™¯]]></summary>
        <content type="html"><![CDATA[<h3 class="anchor anchorWithStickyNavbar_mojV" id="1-èƒŒæ™¯">1. èƒŒæ™¯<a class="hash-link" href="#1-èƒŒæ™¯" title="Direct link to heading">â€‹</a></h3><p>æˆ‘ä»¬çš„é¡¹ç›®æœ‰å¤§é‡çš„apiè¯·æ±‚ç”±goroutineå®Œæˆï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¼•å…¥ä¸€ä¸ªpoolæ¥èŠ‚çœé¢‘ç¹åˆ›å»ºgoroutineæ‰€é€ æˆçš„çš„å¼€é”€ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥æ›´ç®€æ˜“çš„è°ƒåº¦goroutineï¼Œåœ¨å¯¹githubä¸Šå¤šä¸ªåç¨‹æ± çš„å¯¹æ¯”åï¼Œæˆ‘ä»¬æœ€ç»ˆé€‰å®šäº†<a href="https://github.com/panjf2000/ants" target="_blank" rel="noopener noreferrer">ants</a>ä½œä¸ºæˆ‘ä»¬çš„è°ƒåº¦ç®¡ç†poolã€‚</p><ol><li>æœ€è¿‘åœ¨æµ‹è¯•ä¸­å¶ç„¶å‘ç°ç³»ç»Ÿå‡ºç°äº†â€œæ­»é”â€çš„æƒ…å†µï¼Œè¿›è€Œé‡‡å–æ–­ç½‘çš„æ–¹å¼å‘ç°â€œæ­»é”â€åœ¨æç«¯æƒ…å†µä¸‹æ˜¯ç¨³å®šå‡ºç°ï¼Œç»è¿‡æ»¡ç¯‡çš„logï¼Œbreakï¼Œæœ€ç»ˆæŠŠé—®é¢˜å®šä½åˆ°äº†antsçš„submitæ–¹æ³•ã€‚è¿™ä¸ªé—®é¢˜æ¥è‡ªäºåœ¨ä½¿ç”¨ants poolçš„è¿‡ç¨‹ä¸­ï¼Œä¸ºäº†å®ç°é‡è¯•ï¼Œæˆ‘ä»¬åœ¨æ–¹æ³•ä¸­åˆé€’å½’è°ƒç”¨äº†æ–¹æ³•æœ¬èº«ï¼Œä¹Ÿå°±æ˜¯submit taskå†…éƒ¨åˆsubmitä¸€ä¸ªtaskï¼Œä¸‹é¢æ˜¯ç®€åŒ–åçš„ä»£ç ï¼š</li></ol><div class="codeBlockContainer_I0IT language-Go theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-Go codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">func (apiClient *ApiAsyncClient) DoAsync(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   retry int,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) error {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   return apiClient.scheduler.Submit(func() error {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      _, err := apiClient.Do()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      if err != nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         if retry &lt; apiClient.maxRetry {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return apiClient.DoAsync(retry+1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      return err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç å—ä¸­ï¼Œå¯ä»¥çœ‹åˆ°return apiClient.DoAsync(retry+1)è¿™ä¸€æ­¥é€’å½’è°ƒç”¨äº†è‡ªå·±ï¼Œå³åœ¨submitä¸­åˆè°ƒç”¨äº†submit</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="2-æ·±å…¥antsåˆ†æ">2. æ·±å…¥antsåˆ†æ<a class="hash-link" href="#2-æ·±å…¥antsåˆ†æ" title="Direct link to heading">â€‹</a></h3><p><img loading="lazy" alt="img" src="/assets/images/ants_source_code_1-dbc90cd562952b6434590b8ae7121255.png" width="333" height="231" class="img_E7b_"></p><ul><li>åœ¨ä¸Šé¢submitæºç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œé¦–å…ˆæ˜¯é€šè¿‡retrieveWorkerå›å»ä¸€ä¸ªworkerï¼Œç„¶åæŠŠtaskæ”¾å…¥åˆ°workerçš„task channelå½“ä¸­ï¼Œå¾ˆç®€å•ï¼Œä¹Ÿçœ‹ä¸å‡ºæ¥ä¸ºä»€ä¹ˆä¼šâ€œdead lockâ€ï¼Œæ²¡åŠæ³•ï¼Œå»åˆ°retrieveWorker</li></ul><div class="codeBlockContainer_I0IT language-Go theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-Go codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">// retrieveWorker returns a available worker to run the tasks.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func (p *Pool) retrieveWorker() (w *goWorker) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> spawnWorker := func() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  w = p.workerCache.Get().(*goWorker)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  w.run()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> p.lock.Lock()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> w = p.workers.detach()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> if w != nil { // first try to fetch the worker from the queue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  p.lock.Unlock()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> } else if capacity := p.Cap(); capacity == -1 || capacity &gt; p.Running() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // if the worker queue is empty and we don't run out of the pool capacity,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // then just spawn a new worker goroutine.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  p.lock.Unlock()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  spawnWorker()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> } else { // otherwise, we'll have to keep them blocked and wait for at least one worker to be put back into pool.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if p.options.Nonblocking {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   p.lock.Unlock()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> retry:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if p.options.MaxBlockingTasks != 0 &amp;&amp; p.blockingNum &gt;= p.options.MaxBlockingTasks {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   p.lock.Unlock()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  p.blockingNum++</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  p.cond.Wait() // block and wait for an available worker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  p.blockingNum--</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var nw int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if nw = p.Running(); nw == 0 { // awakened by the scavenger</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   p.lock.Unlock()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   if !p.IsClosed() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spawnWorker()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if w = p.workers.detach(); w == nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   if nw &lt; capacity {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    p.lock.Unlock()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spawnWorker()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   goto retry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  p.lock.Unlock()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p><img loading="lazy" alt="img" src="/assets/images/ants_source_code_flowchart-6f51973ac906b9029502a2c9063df6ad.png" width="1280" height="481" class="img_E7b_"></p><ul><li>è¿™ä¸ªæ–¹æ³•çš„å¤§æ¦‚æµç¨‹å°±æ˜¯å…ˆå¯¹poolä¸Šé”ï¼Œç„¶åä»poolçš„workeré˜Ÿåˆ—ä¸­å»å–ä¸€ä¸ªworkerï¼Œdetachå…¶å®å°±æ˜¯è¿”å›äº†workerï¼Œå¹¶ä¸”æŠŠè¿™ä¸ªworkerä»é˜Ÿåˆ—ä¸­åˆ é™¤æ‰äº†ï¼Œæ¥ä¸‹æ¥æœ‰ä¸‰ç§æƒ…å†µ<ul><li>å¦‚æœæˆåŠŸå–åˆ°workerï¼Œè§£é”pï¼Œè¿”å›å–åˆ°çš„worker</li><li>å¦‚æœworkeré˜Ÿåˆ—æ˜¯ç©ºçš„å¹¶ä¸”poolçš„å®¹é‡æ²¡æœ‰è€—å°½ï¼Œå°±è§£é”poolå¹¶ç”Ÿæˆä¸€ä¸ªæ–°çš„workerè¿”å›ç»™submit</li><li>æœ€åä¸€ç§æƒ…å†µå°±æ˜¯poolå®¹é‡è€—å°½äº†ï¼Œworkeré˜Ÿåˆ—ä¹Ÿæ²¡æœ‰ç©ºé—²çš„workerï¼Œé‚£å°±è¦æ ¹æ®æˆ‘ä»¬åˆ›å»ºpoolæ—¶ä¼ å…¥çš„å‚æ•°æ¥å†³å®šä¸‹ä¸€æ­¥æƒ…å†µäº†<ul><li>é¦–å…ˆè¯´ä¸€ä¸‹è¿™é‡Œæ¶‰åŠçš„ä¸¤ä¸ªé‡è¦å‚æ•°ï¼Œä¸€ä¸ªæ˜¯capacityï¼Œè¿™ä¸ªå€¼å¦‚æœåœ¨new poolçš„æ—¶å€™ä¸è®¾ç½®ï¼Œä¼šæ˜¯MaxInt32ï¼Œç›¸å½“äºæ— é™åˆ¶çš„goroutineï¼Œä½†æ˜¯æƒ…å†µä¸åŒçš„æ˜¯ï¼Œæˆ‘ä»¬ä¼šé¦–å…ˆå¤ç”¨ç©ºé—²çš„workerï¼Œè¿˜å¯ä»¥å®šæ—¶æ¸…ç©ºå¤šä½™çš„ç©ºé—²workerï¼ŒblockingNumä¸ºæ­£åœ¨ç­‰å¾…çš„goroutineï¼Œåˆå§‹ä¸º0</li><li>å¦‚æœè®¾ç½®äº†Nonblockingä¸ºtrueï¼Œç›´æ¥è§£é”ï¼Œè¿”å›nilï¼Œsubmitå°±ä¼šç›´æ¥è¿”å›ä¸€ä¸ªé”™è¯¯ErrPoolOverloadï¼Œä»£è¡¨poolè¶…è´Ÿè·äº†ï¼Œä¸åšä»»ä½•å…¶ä»–å¤„ç†ï¼Œsubmitå¤±è´¥ï¼Œç»“æŸ~~</li><li>å¦ä¸€ç§æƒ…å†µå°±æ˜¯æ²¡æœ‰è®¾ç½®Nonblockingï¼Œé»˜è®¤ä¸ºfalseï¼Œå°±è¿›å…¥åˆ°äº†ä¸€ä¸ªretryæ ‡ç­¾ï¼Œè¿™é‡Œé¢å°±æ¶‰åŠåˆ°äº†å¦ä¸€ä¸ªåˆ›å»ºpoolæ—¶å€™çš„å‚æ•°MaxBlockingTasksï¼Œè¿™ä¸ªMaxBlockingTaskså°±æ˜¯ä¸€ä¸ªthreshold<ul><li>é¦–å…ˆåˆ¤æ–­å¦‚æœè®¾ç½®äº†MaxBlockingTaskså¹¶ä¸”å½“å‰blockingNumå¤§äºæˆ–è€…ç­‰äºMaxBlockingTasksï¼Œé‚£ä¹ˆç›´æ¥è§£é”poolå¹¶ä¸”è¿”å›nilï¼Œsubmitå¤±è´¥ï¼Œç»“æŸ~~</li><li>ä¸Šé¢çš„æ¡ä»¶ä¸æ»¡è¶³ï¼Œåˆ™é¦–å…ˆblockingNum++ï¼Œç„¶åå¼€å§‹waitä¸€ç›´åˆ°æœ‰workeræ‘¸å®Œé±¼å›æ¥å·¥ä½œï¼Œåˆ™blockingNum--ã€‚é—®é¢˜å°±åœ¨è¿™é‡Œäº†ï¼ï¼ï¼å¦‚æœæ‰€æœ‰çš„workeréƒ½åœ¨å·¥ä½œï¼ˆä¹Ÿè®¸æ˜¯çœ‹èµ·æ¥åœ¨å·¥ä½œï¼Œå®é™…ä¸Šåœ¨æ‘¸é±¼ï¼‰ï¼Œè¿™é‡Œå°±ä¼šä¸€ç›´wait()ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è‡ªå·±ä»£ç ä¸­returnåé¢çš„DoAsyncä¼šä¸€ç›´wait()ï¼Œä»æˆ‘ä»¬è‡ªå·±çš„é¡¹ç›®æ¥è®²ï¼Œå°±æ˜¯æ‰€æœ‰workerè¿™ä¸ªæ—¶å€™éƒ½åœ¨submitä¸€ä¸ªæ–°çš„taskåˆ°åŒä¸€ä¸ªpoolä¸­ï¼Œè€Œè¿™ä¸ªæ—¶å€™poolå·²ç»æ»¡äº†ï¼Œå¯¼è‡´æ‰€æœ‰workeréƒ½é˜»å¡åœ¨äº†è¿™é‡Œï¼Œâ€œæ­»é”â€ä¹Ÿå°±å‡ºç°äº†</li></ul></li></ul></li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="3-æœ€åèŠå‡ å¥è‡ªå·±å¯¹äºgolangå†…å­˜æ¨¡å‹çš„ç†è§£">3. æœ€åèŠå‡ å¥è‡ªå·±å¯¹äºgolangå†…å­˜æ¨¡å‹çš„ç†è§£<a class="hash-link" href="#3-æœ€åèŠå‡ å¥è‡ªå·±å¯¹äºgolangå†…å­˜æ¨¡å‹çš„ç†è§£" title="Direct link to heading">â€‹</a></h3><ol><li>goçš„è°ƒåº¦æµç¨‹æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªç”Ÿäº§-æ¶ˆè´¹çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬åˆ©ç”¨go funcæ˜¯ç”Ÿäº§äº†ä¸€ä¸ªtaskæ”¾åˆ°é˜Ÿåˆ—ä¸­ï¼Œç”±ç³»ç»Ÿçº¿ç¨‹ä»é˜Ÿåˆ—ä¸­è·å–åç¨‹ç„¶åæ‰§è¡Œ</li><li>è®²åˆ°goçš„è°ƒåº¦æµç¨‹ï¼Œå’±ä»¬å°±ä¸èƒ½ä¸è¯´ä¸€ä¸‹goçš„MPGï¼ˆåˆ†åˆ«è§£é‡Šä¸€ä¸‹ï¼Œå°±ä¸åšæ·±å…¥äº†ï¼Œå¦‚æœæœ‰äººçœ‹ï¼ŒåæœŸå†åŠªåŠ›æ•´ç†ä¸€ä»½è¯¦ç»†èŠèŠï¼‰<ol><li>M ä»£è¡¨ç€ä¸€ä¸ªå†…æ ¸çº¿ç¨‹ï¼Œä¹Ÿå¯ä»¥ç§°ä¸ºä¸€ä¸ªå·¥ä½œçº¿ç¨‹ï¼Œæ‰€æœ‰çš„goroutineéƒ½æ˜¯è·‘åœ¨Mä¹‹ä¸Šçš„</li><li>På¯ä»¥ç†è§£ä¸ºä¸€ä¸ªé€»è¾‘å¤„ç†å™¨ï¼Œä¸»è¦ç”±Pæ¥æ‰§è¡Œgoroutine</li><li>Gå°±æ˜¯go funcå°è£…çš„è¿™ä¸ªæ–¹æ³•</li></ol></li><li>çœŸæ­£çš„å¹¶å‘æ•°æ˜¯ç”±GOMAXPROCSæ¥å†³å®šçš„ï¼Œå¹¶ä¸æ˜¯æäº¤å¤šå°‘goroutineï¼Œå¹¶å‘æ•°å°±æ˜¯å¤šå°‘ï¼ŒGOMAXPROCSæ˜¯ç”±æœºå™¨çš„cpuæ ¸æ•°æ¥å†³å®šçš„</li><li>æ‰€ä»¥å›åˆ°ç¬¬2éƒ¨åˆ†ï¼Œpool.cond.waitç­‰å¾…çš„æ˜¯ç»‘å®šä¸Šä¸€ä¸ªgoroutineï¼Œå’Œå…¶ä»–è¯­è¨€çš„ç­‰å¾…çº¿ç¨‹å…·æœ‰ç›¸ä¼¼å´å®Œå…¨ä¸åŒçš„æ„ä¹‰ï¼Œæ¯ä¸€ä¸ªworkeræ˜¯ä¸€ä¸ªGï¼Œpoolä¹Ÿå°±æ˜¯ä¸€ä¸ªé˜Ÿåˆ—ï¼Œè€ŒMä¼šä»é˜Ÿåˆ—ä¸­è·å–å¯ä»¥æ‰§è¡Œçš„Gï¼Œå½“æ‰€æœ‰çš„Géƒ½åœ¨ç­‰å¾…åˆ›å»ºæ–°çš„Gæ—¶ï¼ŒMå…¨éƒ¨éƒ½å¤„äºç©ºé—²çŠ¶æ€</li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="4-è§£å†³æ–¹æ¡ˆ">4. è§£å†³æ–¹æ¡ˆ<a class="hash-link" href="#4-è§£å†³æ–¹æ¡ˆ" title="Direct link to heading">â€‹</a></h3><ol><li>å½“ç„¶ï¼Œæœ€é è°±çš„åº”è¯¥æ˜¯å°½é‡é¿å…ç±»ä¼¼è¿™æ ·çš„é€’å½’è°ƒç”¨æ“ä½œ</li><li>å¦‚æœå®åœ¨ä¸è¡Œï¼Œå¯ä»¥è€ƒè™‘æ·»åŠ ä¸€ä¸ªsub poolï¼Œä½œä¸ºæ¬¡çº§é˜Ÿåˆ—ï¼Œè®©é€’å½’ç”Ÿæˆçš„Gå¯ä»¥åœ¨sub poolé‡Œç­‰å¾…ç©ºé—²çš„Mæ¥å¤„ç†</li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="5-å¯¹æ¯”ä¸åŒsizeçš„poolå’Œä¸¤ä¸ªpoolçš„å†…å­˜alloc_spaceå’Œcpuå¼€é”€">5. å¯¹æ¯”ä¸åŒsizeçš„poolå’Œä¸¤ä¸ªpoolçš„å†…å­˜ï¼ˆalloc_spaceï¼‰å’ŒCPUå¼€é”€<a class="hash-link" href="#5-å¯¹æ¯”ä¸åŒsizeçš„poolå’Œä¸¤ä¸ªpoolçš„å†…å­˜alloc_spaceå’Œcpuå¼€é”€" title="Direct link to heading">â€‹</a></h3><table><thead><tr><th>Pool size</th><th>CPU(ants)%</th><th>CPU(runtime.gcBgMarkWorker)%</th><th>CPU(runtime.mcall)%</th><th>å†…å­˜(runtime.allocm)kB</th><th>å†…å­˜(runtime.gcBgMarkWorker)kB</th><th>å†…å­˜(root)</th></tr></thead><tbody><tr><td>Two pools(158, 632)</td><td>27.98</td><td>7.73</td><td>25.44</td><td>2050.25</td><td>512.02</td><td>8798</td></tr><tr><td>Pool 158</td><td>28.11</td><td>6.61</td><td>25.08</td><td>2050</td><td></td><td>6661</td></tr><tr><td>Pool 1580</td><td>27.41</td><td>12.96</td><td>23.17</td><td>3075.38</td><td></td><td>10264</td></tr><tr><td>Pool 7900</td><td>25.89</td><td>9.82</td><td>22.52</td><td>3587.94</td><td></td><td>5725</td></tr><tr><td>Pool 790000</td><td>25.12</td><td>12.79</td><td>23.44</td><td>3075.38</td><td></td><td>9748</td></tr></tbody></table><p>runtime.gcBgMarkWorker: ç”¨äºæ ‡è®°åƒåœ¾å¯¹è±¡</p><p>ä»ä¸Šé¢çš„è¡¨æ ¼å¯ä»¥çœ‹åˆ°ï¼Œå¯èƒ½å­˜åœ¨å¤šæ ¸çš„å½±å“ï¼Œæ‰€ä»¥å¯¹äºæˆ‘ä»¬å…¬å¸ç°åœ¨éœ€è¦çš„å¹¶å‘æ•°é‡çº§æ¥è®²ï¼Œpoolçš„sizeå¯¹ç³»ç»Ÿå½±å“å¹¶ä¸å¤§ã€‚</p>]]></content>
        <author>
            <name>Warren Chen (é™ˆæ˜ åˆ)</name>
            <uri>https://github.com/warren830</uri>
        </author>
        <category label="devlake" term="devlake"/>
        <category label="ants" term="ants"/>
    </entry>
</feed>