<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/">
    <channel>
        <title>Apache DevLake (Incubating) Blog</title>
        <link>https://devlake.apache.org/blog</link>
        <description>Apache DevLake (Incubating) Blog</description>
        <lastBuildDate>Wed, 18 May 2022 00:00:00 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>en</language>
        <item>
            <title><![CDATA[Apache Incubator Welcomes DevLake, A Dev-Data Platform Serving Developers]]></title>
            <link>https://devlake.apache.org/blog/apache-welcomes-devlake</link>
            <guid>apache-welcomes-devlake</guid>
            <pubDate>Wed, 18 May 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[We are excited to share today that the Apache Software Foundation (ASF) voted to make DevLake an officially supported project of the Apache Incubator.]]></description>
            <content:encoded><![CDATA[<p>We are excited to share today that the Apache Software Foundation (ASF) voted to make DevLake an officially supported project of the Apache Incubator.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="what-is-devlake">What is DevLake?<a class="hash-link" href="#what-is-devlake" title="Direct link to heading">â€‹</a></h3><p>Launched in December of 2021, <a href="https://github.com/apache/incubator-devlake" target="_blank" rel="noopener noreferrer">DevLake</a> is an open-source dev data platform that ingests, analyzes, and visualizes the fragmented data in developer tools. </p><p>Software development is complex, requiring many tools and processes, and as a result creates a storm of data scattered across tools in many formats. This makes it difficult to organize, query, and make sense of.  We built DevLake, to make it easy to make sense of this rich data and to translate it into actionable insights.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="devlakes-key-features">DevLake's key features:<a class="hash-link" href="#devlakes-key-features" title="Direct link to heading">â€‹</a></h3><ul><li>Collect DevOps data across software development lifecycle (SDLC) to connect data islands.</li><li>Standardized data models with out-of-the-box metrics and customizable dashboards.</li><li>Flexible plugin system for user-defined data integration and transformation.</li></ul><p>Below is the architecture of DevLake:
<img loading="lazy" alt="architecture" src="/assets/images/0.11-architecture-diagram-f422e47efad0b84f72eb3bc51c7d1f1b.jpg" width="2143" height="1182" class="img_E7b_"></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="why-join-apache-incubator">Why join Apache Incubator?<a class="hash-link" href="#why-join-apache-incubator" title="Direct link to heading">â€‹</a></h3><p>First and foremost, we firmly believe in Apache's principle of "Community over Code" and <a href="https://www.apache.org/theapacheway/index.html" target="_blank" rel="noopener noreferrer">"The Apache Way"</a>. We look forward to building a vibrant, inclusive, and diverse community under the guidance of our mentors through the incubator journey.</p><p>We also feel that the Apache community has one of the strongest ecosystems when it comes to data-oriented open-source projects. </p><p>Last and not least, the support and enthusiasm of the Apache community and mentors made it clear to us that this would be a place where we can truly evolve and nurture DevLake.</p><p>In the months leading up to DevLake's acceptance, our mentors provided guidance and suggestions instrumental to making this important moment a reality. We want to take this opportunity to thank and acknowledge them: </p><ul><li><p><strong><a href="https://github.com/WillemJiang" target="_blank" rel="noopener noreferrer">Willem Ning Jiang</a></strong>: DevLake Champion; ASF Member &amp; Board Director</p></li><li><p><strong><a href="https://github.com/terrymanu" target="_blank" rel="noopener noreferrer">Liang Zhang</a></strong>: Founder &amp; CEO of SphereEx; ASF Member, Founder &amp; PMC Chair of Apache ShardingSphere</p></li><li><p><strong><a href="https://github.com/dailidong" target="_blank" rel="noopener noreferrer">Lidong Dai</a></strong>: ASF Member; Apache DolphinScheduler PMC Chair</p></li><li><p><strong><a href="https://github.com/sijie" target="_blank" rel="noopener noreferrer">Sijie Guo</a></strong>: ASF Member, PMC member of Apache Pulsar; Founder &amp; CEO of StreamNative</p></li><li><p><strong><a href="https://github.com/felixcheung" target="_blank" rel="noopener noreferrer">Felix Cheung</a></strong>: ASF Member, PMC on Spark, Superset, Yunikorn, Zeppelin, Pinot, and Incubator. SVP of Engineering at SafeGraph.</p></li><li><p><strong><a href="https://github.com/jbonofre" target="_blank" rel="noopener noreferrer">Jean-Baptiste OnofrÃ©</a></strong>: ASF Member, Karaf PMC Chair, PMC on ActiveMQ, Archiva, Aries, Beam, Brooklyn, Camel, Carbondata, Felix, Incubator, and <a href="http://people.apache.org/committer-index.html" target="_blank" rel="noopener noreferrer">many more</a>.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="devlake-future-roadmap">DevLake Future Roadmap<a class="hash-link" href="#devlake-future-roadmap" title="Direct link to heading">â€‹</a></h3><ul><li>Enhance system scalability and performance in large-scale data scenarios.</li><li>Integrate more data sources and tools (JIRA, GitHub, GitLab, and Jenkins are already supported.)</li><li>Enable support for OLAP databases, providing users with more choices.</li><li>Provide more scenario-specific, out-of-the-box dashboards and templates reflecting best practices and well-known methodologies to improve usability.</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="join-us">Join us!<a class="hash-link" href="#join-us" title="Direct link to heading">â€‹</a></h3><p>We invite developers and those passionate about data-driven engineering to 'dive into the lake' with us, and welcome contributions of all kinds.
Join us on Slack and at our weekly open source community meetupsğŸ¥³</p><p><strong>Apache DevLake (Incubating) Links:</strong></p><ul><li>GitHub:  <a href="https://github.com/apache/incubator-devlake" target="_blank" rel="noopener noreferrer">https://github.com/apache/incubator-devlake</a></li><li>DevLake Official Website: <a href="https://devlake.apache.org/" target="_blank" rel="noopener noreferrer">https://devlake.apache.org/</a></li><li>Slack:  <a href="https://join.slack.com/t/devlake-io/shared_invite/zt-18uayb6ut-_P30EyJIxavGtZ3vTHWLJA" target="_blank" rel="noopener noreferrer">https://join.slack.com/t/devlake-io/shared_invite/zt-18uayb6ut-_P30EyJIxavGtZ3vTHWLJA</a></li><li>DevLake Podling Websiteï¼š<a href="https://incubator.apache.org/projects/devlake.html" target="_blank" rel="noopener noreferrer">https://incubator.apache.org/projects/devlake.html</a></li></ul>]]></content:encoded>
            <category>Devlake</category>
            <category>Apache</category>
        </item>
        <item>
            <title><![CDATA[ä½¿ç”¨antså¼•å‘çš„æ­»é”]]></title>
            <link>https://devlake.apache.org/blog/deadlock-caused-by-using-ants</link>
            <guid>deadlock-caused-by-using-ants</guid>
            <pubDate>Sat, 30 Apr 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[1. èƒŒæ™¯]]></description>
            <content:encoded><![CDATA[<h3 class="anchor anchorWithStickyNavbar_mojV" id="1-èƒŒæ™¯">1. èƒŒæ™¯<a class="hash-link" href="#1-èƒŒæ™¯" title="Direct link to heading">â€‹</a></h3><p>æˆ‘ä»¬çš„é¡¹ç›®æœ‰å¤§é‡çš„apiè¯·æ±‚ç”±goroutineå®Œæˆï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¼•å…¥ä¸€ä¸ªpoolæ¥èŠ‚çœé¢‘ç¹åˆ›å»ºgoroutineæ‰€é€ æˆçš„çš„å¼€é”€ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥æ›´ç®€æ˜“çš„è°ƒåº¦goroutineï¼Œåœ¨å¯¹githubä¸Šå¤šä¸ªåç¨‹æ± çš„å¯¹æ¯”åï¼Œæˆ‘ä»¬æœ€ç»ˆé€‰å®šäº†<a href="https://github.com/panjf2000/ants" target="_blank" rel="noopener noreferrer">ants</a>ä½œä¸ºæˆ‘ä»¬çš„è°ƒåº¦ç®¡ç†poolã€‚</p><ol><li>æœ€è¿‘åœ¨æµ‹è¯•ä¸­å¶ç„¶å‘ç°ç³»ç»Ÿå‡ºç°äº†â€œæ­»é”â€çš„æƒ…å†µï¼Œè¿›è€Œé‡‡å–æ–­ç½‘çš„æ–¹å¼å‘ç°â€œæ­»é”â€åœ¨æç«¯æƒ…å†µä¸‹æ˜¯ç¨³å®šå‡ºç°ï¼Œç»è¿‡æ»¡ç¯‡çš„logï¼Œbreakï¼Œæœ€ç»ˆæŠŠé—®é¢˜å®šä½åˆ°äº†antsçš„submitæ–¹æ³•ã€‚è¿™ä¸ªé—®é¢˜æ¥è‡ªäºåœ¨ä½¿ç”¨ants poolçš„è¿‡ç¨‹ä¸­ï¼Œä¸ºäº†å®ç°é‡è¯•ï¼Œæˆ‘ä»¬åœ¨æ–¹æ³•ä¸­åˆé€’å½’è°ƒç”¨äº†æ–¹æ³•æœ¬èº«ï¼Œä¹Ÿå°±æ˜¯submit taskå†…éƒ¨åˆsubmitä¸€ä¸ªtaskï¼Œä¸‹é¢æ˜¯ç®€åŒ–åçš„ä»£ç </li></ol><div class="codeBlockContainer_I0IT language-Go theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-Go codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">func (apiClient *ApiAsyncClient) DoAsync(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   retry int,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) error {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   return apiClient.scheduler.Submit(func() error {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      _, err := apiClient.Do()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      if err != nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         if retry &lt; apiClient.maxRetry {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return apiClient.DoAsync(retry+1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      return err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç å—ä¸­ï¼Œå¯ä»¥çœ‹åˆ°return apiClient.DoAsync(retry+1)è¿™ä¸€æ­¥é€’å½’è°ƒç”¨äº†è‡ªå·±ï¼Œå³åœ¨submitä¸­åˆè°ƒç”¨äº†submit</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="2-æ·±å…¥antsåˆ†æ">2. æ·±å…¥antsåˆ†æ<a class="hash-link" href="#2-æ·±å…¥antsåˆ†æ" title="Direct link to heading">â€‹</a></h3><p><img loading="lazy" alt="img" src="/assets/images/ants_source_code_1-dbc90cd562952b6434590b8ae7121255.png" width="333" height="231" class="img_E7b_"></p><ul><li>åœ¨ä¸Šé¢submitæºç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œé¦–å…ˆæ˜¯é€šè¿‡retrieveWorkerå›å»ä¸€ä¸ªworkerï¼Œç„¶åæŠŠtaskæ”¾å…¥åˆ°workerçš„task channelå½“ä¸­ï¼Œå¾ˆç®€å•ï¼Œä¹Ÿçœ‹ä¸å‡ºæ¥ä¸ºä»€ä¹ˆä¼šâ€œdead lockâ€ï¼Œæ²¡åŠæ³•ï¼Œå»åˆ°retrieveWorker</li></ul><div class="codeBlockContainer_I0IT language-Go theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-Go codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">// retrieveWorker returns a available worker to run the tasks.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func (p *Pool) retrieveWorker() (w *goWorker) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> spawnWorker := func() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  w = p.workerCache.Get().(*goWorker)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  w.run()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> p.lock.Lock()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> w = p.workers.detach()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> if w != nil { // first try to fetch the worker from the queue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  p.lock.Unlock()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> } else if capacity := p.Cap(); capacity == -1 || capacity &gt; p.Running() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // if the worker queue is empty and we don't run out of the pool capacity,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // then just spawn a new worker goroutine.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  p.lock.Unlock()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  spawnWorker()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> } else { // otherwise, we'll have to keep them blocked and wait for at least one worker to be put back into pool.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if p.options.Nonblocking {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   p.lock.Unlock()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> retry:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if p.options.MaxBlockingTasks != 0 &amp;&amp; p.blockingNum &gt;= p.options.MaxBlockingTasks {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   p.lock.Unlock()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  p.blockingNum++</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  p.cond.Wait() // block and wait for an available worker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  p.blockingNum--</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var nw int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if nw = p.Running(); nw == 0 { // awakened by the scavenger</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   p.lock.Unlock()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   if !p.IsClosed() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spawnWorker()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if w = p.workers.detach(); w == nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   if nw &lt; capacity {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    p.lock.Unlock()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spawnWorker()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   goto retry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  p.lock.Unlock()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p><img loading="lazy" alt="img" src="/assets/images/ants_source_code_flowchart-6f51973ac906b9029502a2c9063df6ad.png" width="1280" height="481" class="img_E7b_"></p><ul><li>è¿™ä¸ªæ–¹æ³•çš„å¤§æ¦‚æµç¨‹å°±æ˜¯å…ˆå¯¹poolä¸Šé”ï¼Œç„¶åä»poolçš„workeré˜Ÿåˆ—ä¸­å»å–ä¸€ä¸ªworkerï¼Œdetachå…¶å®å°±æ˜¯è¿”å›äº†workerï¼Œå¹¶ä¸”æŠŠè¿™ä¸ªworkerä»é˜Ÿåˆ—ä¸­åˆ é™¤æ‰äº†ï¼Œæ¥ä¸‹æ¥æœ‰ä¸‰ç§æƒ…å†µ<ul><li>å¦‚æœæˆåŠŸå–åˆ°workerï¼Œè§£é”pï¼Œè¿”å›å–åˆ°çš„worker</li><li>å¦‚æœworkeré˜Ÿåˆ—æ˜¯ç©ºçš„å¹¶ä¸”poolçš„å®¹é‡æ²¡æœ‰è€—å°½ï¼Œå°±è§£é”poolå¹¶ç”Ÿæˆä¸€ä¸ªæ–°çš„workerè¿”å›ç»™submit</li><li>æœ€åä¸€ç§æƒ…å†µå°±æ˜¯poolå®¹é‡è€—å°½äº†ï¼Œworkeré˜Ÿåˆ—ä¹Ÿæ²¡æœ‰ç©ºé—²çš„workerï¼Œé‚£å°±è¦æ ¹æ®æˆ‘ä»¬åˆ›å»ºpoolæ—¶ä¼ å…¥çš„å‚æ•°æ¥å†³å®šä¸‹ä¸€æ­¥æƒ…å†µäº†<ul><li>é¦–å…ˆè¯´ä¸€ä¸‹è¿™é‡Œæ¶‰åŠçš„ä¸¤ä¸ªé‡è¦å‚æ•°ï¼Œä¸€ä¸ªæ˜¯capacityï¼Œè¿™ä¸ªå€¼å¦‚æœåœ¨new poolçš„æ—¶å€™ä¸è®¾ç½®ï¼Œä¼šæ˜¯MaxInt32ï¼Œç›¸å½“äºæ— é™åˆ¶çš„goroutineï¼Œä½†æ˜¯æƒ…å†µä¸åŒçš„æ˜¯ï¼Œæˆ‘ä»¬ä¼šé¦–å…ˆå¤ç”¨ç©ºé—²çš„workerï¼Œè¿˜å¯ä»¥å®šæ—¶æ¸…ç©ºå¤šä½™çš„ç©ºé—²workerï¼ŒblockingNumä¸ºæ­£åœ¨ç­‰å¾…çš„goroutineï¼Œåˆå§‹ä¸º0</li><li>å¦‚æœè®¾ç½®äº†Nonblockingä¸ºtrueï¼Œç›´æ¥è§£é”ï¼Œè¿”å›nilï¼Œsubmitå°±ä¼šç›´æ¥è¿”å›ä¸€ä¸ªé”™è¯¯ErrPoolOverloadï¼Œä»£è¡¨poolè¶…è´Ÿè·äº†ï¼Œä¸åšä»»ä½•å…¶ä»–å¤„ç†ï¼Œsubmitå¤±è´¥ï¼Œç»“æŸ~~</li><li>å¦ä¸€ç§æƒ…å†µå°±æ˜¯æ²¡æœ‰è®¾ç½®Nonblockingï¼Œé»˜è®¤ä¸ºfalseï¼Œå°±è¿›å…¥åˆ°äº†ä¸€ä¸ªretryæ ‡ç­¾ï¼Œè¿™é‡Œé¢å°±æ¶‰åŠåˆ°äº†å¦ä¸€ä¸ªåˆ›å»ºpoolæ—¶å€™çš„å‚æ•°MaxBlockingTasksï¼Œè¿™ä¸ªMaxBlockingTaskså°±æ˜¯ä¸€ä¸ªthreshold<ul><li>é¦–å…ˆåˆ¤æ–­å¦‚æœè®¾ç½®äº†MaxBlockingTaskså¹¶ä¸”å½“å‰blockingNumå¤§äºæˆ–è€…ç­‰äºMaxBlockingTasksï¼Œé‚£ä¹ˆç›´æ¥è§£é”poolå¹¶ä¸”è¿”å›nilï¼Œsubmitå¤±è´¥ï¼Œç»“æŸ~~</li><li>ä¸Šé¢çš„æ¡ä»¶ä¸æ»¡è¶³ï¼Œåˆ™é¦–å…ˆblockingNum++ï¼Œç„¶åå¼€å§‹waitä¸€ç›´åˆ°æœ‰workeræ‘¸å®Œé±¼å›æ¥å·¥ä½œï¼Œåˆ™blockingNum--ã€‚é—®é¢˜å°±åœ¨è¿™é‡Œäº†ï¼ï¼ï¼å¦‚æœæ‰€æœ‰çš„workeréƒ½åœ¨å·¥ä½œï¼ˆä¹Ÿè®¸æ˜¯çœ‹èµ·æ¥åœ¨å·¥ä½œï¼Œå®é™…ä¸Šåœ¨æ‘¸é±¼ï¼‰ï¼Œè¿™é‡Œå°±ä¼šä¸€ç›´wait()ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è‡ªå·±ä»£ç ä¸­returnåé¢çš„DoAsyncä¼šä¸€ç›´wait()ï¼Œä»æˆ‘ä»¬è‡ªå·±çš„é¡¹ç›®æ¥è®²ï¼Œå°±æ˜¯æ‰€æœ‰workerè¿™ä¸ªæ—¶å€™éƒ½åœ¨submitä¸€ä¸ªæ–°çš„taskåˆ°åŒä¸€ä¸ªpoolä¸­ï¼Œè€Œè¿™ä¸ªæ—¶å€™poolå·²ç»æ»¡äº†ï¼Œå¯¼è‡´æ‰€æœ‰workeréƒ½é˜»å¡åœ¨äº†è¿™é‡Œï¼Œâ€œæ­»é”â€ä¹Ÿå°±å‡ºç°äº†</li></ul></li></ul></li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="3-æœ€åèŠå‡ å¥è‡ªå·±å¯¹äºgolangå†…å­˜æ¨¡å‹çš„ç†è§£">3. æœ€åèŠå‡ å¥è‡ªå·±å¯¹äºgolangå†…å­˜æ¨¡å‹çš„ç†è§£<a class="hash-link" href="#3-æœ€åèŠå‡ å¥è‡ªå·±å¯¹äºgolangå†…å­˜æ¨¡å‹çš„ç†è§£" title="Direct link to heading">â€‹</a></h3><ol><li>goçš„è°ƒåº¦æµç¨‹æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªç”Ÿäº§-æ¶ˆè´¹çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬åˆ©ç”¨go funcæ˜¯ç”Ÿäº§äº†ä¸€ä¸ªtaskæ”¾åˆ°é˜Ÿåˆ—ä¸­ï¼Œç”±ç³»ç»Ÿçº¿ç¨‹ä»é˜Ÿåˆ—ä¸­è·å–åç¨‹ç„¶åæ‰§è¡Œ</li><li>è®²åˆ°goçš„è°ƒåº¦æµç¨‹ï¼Œå’±ä»¬å°±ä¸èƒ½ä¸è¯´ä¸€ä¸‹goçš„MPGï¼ˆåˆ†åˆ«è§£é‡Šä¸€ä¸‹ï¼Œå°±ä¸åšæ·±å…¥äº†ï¼Œå¦‚æœæœ‰äººçœ‹ï¼ŒåæœŸå†åŠªåŠ›æ•´ç†ä¸€ä»½è¯¦ç»†èŠèŠï¼‰<ol><li>M ä»£è¡¨ç€ä¸€ä¸ªå†…æ ¸çº¿ç¨‹ï¼Œä¹Ÿå¯ä»¥ç§°ä¸ºä¸€ä¸ªå·¥ä½œçº¿ç¨‹ï¼Œæ‰€æœ‰çš„goroutineéƒ½æ˜¯è·‘åœ¨Mä¹‹ä¸Šçš„</li><li>På¯ä»¥ç†è§£ä¸ºä¸€ä¸ªé€»è¾‘å¤„ç†å™¨ï¼Œä¸»è¦ç”±Pæ¥æ‰§è¡Œgoroutine</li><li>Gå°±æ˜¯go funcå°è£…çš„è¿™ä¸ªæ–¹æ³•</li></ol></li><li>çœŸæ­£çš„å¹¶å‘æ•°æ˜¯ç”±GOMAXPROCSæ¥å†³å®šçš„ï¼Œå¹¶ä¸æ˜¯æäº¤å¤šå°‘goroutineï¼Œå¹¶å‘æ•°å°±æ˜¯å¤šå°‘ï¼ŒGOMAXPROCSæ˜¯ç”±æœºå™¨çš„cpuæ ¸æ•°æ¥å†³å®šçš„</li><li>æ‰€ä»¥å›åˆ°ç¬¬2éƒ¨åˆ†ï¼Œpool.cond.waitç­‰å¾…çš„æ˜¯ç»‘å®šä¸Šä¸€ä¸ªgoroutineï¼Œå’Œå…¶ä»–è¯­è¨€çš„ç­‰å¾…çº¿ç¨‹å…·æœ‰ç›¸ä¼¼å´å®Œå…¨ä¸åŒçš„æ„ä¹‰ï¼Œæ¯ä¸€ä¸ªworkeræ˜¯ä¸€ä¸ªGï¼Œpoolä¹Ÿå°±æ˜¯ä¸€ä¸ªé˜Ÿåˆ—ï¼Œè€ŒMä¼šä»é˜Ÿåˆ—ä¸­è·å–å¯ä»¥æ‰§è¡Œçš„Gï¼Œå½“æ‰€æœ‰çš„Géƒ½åœ¨ç­‰å¾…åˆ›å»ºæ–°çš„Gæ—¶ï¼ŒMå…¨éƒ¨éƒ½å¤„äºç©ºé—²çŠ¶æ€</li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="4-è§£å†³æ–¹æ¡ˆ">4. è§£å†³æ–¹æ¡ˆ<a class="hash-link" href="#4-è§£å†³æ–¹æ¡ˆ" title="Direct link to heading">â€‹</a></h3><ol><li>å½“ç„¶ï¼Œæœ€é è°±çš„åº”è¯¥æ˜¯å°½é‡é¿å…ç±»ä¼¼è¿™æ ·çš„é€’å½’è°ƒç”¨æ“ä½œ</li><li>å¦‚æœå®åœ¨ä¸è¡Œï¼Œå¯ä»¥è€ƒè™‘æ·»åŠ ä¸€ä¸ªsub poolï¼Œä½œä¸ºæ¬¡çº§é˜Ÿåˆ—ï¼Œè®©é€’å½’ç”Ÿæˆçš„Gå¯ä»¥åœ¨sub poolé‡Œç­‰å¾…ç©ºé—²çš„Mæ¥å¤„ç†</li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="5-å¯¹æ¯”ä¸åŒsizeçš„poolå’Œä¸¤ä¸ªpoolçš„å†…å­˜alloc_spaceå’Œcpuå¼€é”€">5. å¯¹æ¯”ä¸åŒsizeçš„poolå’Œä¸¤ä¸ªpoolçš„å†…å­˜ï¼ˆalloc_spaceï¼‰å’ŒCPUå¼€é”€<a class="hash-link" href="#5-å¯¹æ¯”ä¸åŒsizeçš„poolå’Œä¸¤ä¸ªpoolçš„å†…å­˜alloc_spaceå’Œcpuå¼€é”€" title="Direct link to heading">â€‹</a></h3><table><thead><tr><th>Pool size</th><th>CPU(ants)%</th><th>CPU(runtime.gcBgMarkWorker)%</th><th>CPU(runtime.mcall)%</th><th>å†…å­˜(runtime.allocm)kB</th><th>å†…å­˜(runtime.gcBgMarkWorker)kB</th><th>å†…å­˜(root)</th></tr></thead><tbody><tr><td>Two pools(158, 632)</td><td>27.98</td><td>7.73</td><td>25.44</td><td>2050.25</td><td>512.02</td><td>8798</td></tr><tr><td>Pool 158</td><td>28.11</td><td>6.61</td><td>25.08</td><td>2050</td><td></td><td>6661</td></tr><tr><td>Pool 1580</td><td>27.41</td><td>12.96</td><td>23.17</td><td>3075.38</td><td></td><td>10264</td></tr><tr><td>Pool 7900</td><td>25.89</td><td>9.82</td><td>22.52</td><td>3587.94</td><td></td><td>5725</td></tr><tr><td>Pool 790000</td><td>25.12</td><td>12.79</td><td>23.44</td><td>3075.38</td><td></td><td>9748</td></tr></tbody></table><p>runtime.gcBgMarkWorker: ç”¨äºæ ‡è®°åƒåœ¾å¯¹è±¡</p><p>ä»ä¸Šé¢çš„è¡¨æ ¼å¯ä»¥çœ‹åˆ°ï¼Œå¯èƒ½å­˜åœ¨å¤šæ ¸çš„å½±å“ï¼Œæ‰€ä»¥å¯¹äºæˆ‘ä»¬å…¬å¸ç°åœ¨éœ€è¦çš„å¹¶å‘æ•°é‡çº§æ¥è®²ï¼Œpoolçš„sizeå¯¹ç³»ç»Ÿå½±å“å¹¶ä¸å¤§ã€‚</p>]]></content:encoded>
            <category>devlake</category>
            <category>ants</category>
        </item>
    </channel>
</rss>