"use strict";(self.webpackChunkwww=self.webpackChunkwww||[]).push([[6494],{93097:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>r,contentTitle:()=>s,default:()=>u,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var n=i(87462),a=(i(67294),i(3905));i(61839);const o={title:"Bitbucket Cloud",sidebar_position:7,description:"Config UI instruction for Bitbucket(Cloud)"},s=void 0,l={unversionedId:"Configuration/BitBucket",id:"version-v1.0/Configuration/BitBucket",title:"Bitbucket Cloud",description:"Config UI instruction for Bitbucket(Cloud)",source:"@site/versioned_docs/version-v1.0/Configuration/BitBucket.md",sourceDirName:"Configuration",slug:"/Configuration/BitBucket",permalink:"/zh/docs/v1.0/Configuration/BitBucket",draft:!1,editUrl:"https://github.com/apache/incubator-devlake-website/edit/main/versioned_docs/version-v1.0/Configuration/BitBucket.md",tags:[],version:"v1.0",sidebarPosition:7,frontMatter:{title:"Bitbucket Cloud",sidebar_position:7,description:"Config UI instruction for Bitbucket(Cloud)"},sidebar:"docsSidebar",previous:{title:"Azure DevOps",permalink:"/zh/docs/v1.0/Configuration/AzureDevOps"},next:{title:"Bitbucket Server/Data Center",permalink:"/zh/docs/v1.0/Configuration/BitBucketServer"}},r={},p=[{value:"Step 1 - Add Data Connections",id:"step-1---add-data-connections",level:2},{value:"Step 1.1 - Authentication",id:"step-11---authentication",level:3},{value:"Connection Name",id:"connection-name",level:4},{value:"Endpoint URL",id:"endpoint-url",level:4},{value:"Username and App Password",id:"username-and-app-password",level:4},{value:"Proxy URL (Optional)",id:"proxy-url-optional",level:4},{value:"Fixed Rate Limit (Optional)",id:"fixed-rate-limit-optional",level:4},{value:"Test and Save Connection",id:"test-and-save-connection",level:4},{value:"Step 1.2 - Add Data Scopes",id:"step-12---add-data-scopes",level:3},{value:"Step 1.3 - Add Scope Config (Optional)",id:"step-13---add-scope-config-optional",level:3},{value:"Entities",id:"entities",level:4},{value:"Transformations",id:"transformations",level:4},{value:"Issue Tracking &gt; Issue Status Mapping",id:"issue-tracking--issue-status-mapping",level:6},{value:"Issue Tracking &gt; Issue Type Mapping",id:"issue-tracking--issue-type-mapping",level:6},{value:"CI/CD",id:"cicd",level:6},{value:"Introduction to Bitbucket CI entities",id:"introduction-to-bitbucket-ci-entities",level:6},{value:"Additional Settings (Optional)",id:"additional-settings-optional",level:6},{value:"Step 2 - Collect Data in a Project",id:"step-2---collect-data-in-a-project",level:2},{value:"Step 2.1 - Create a Project",id:"step-21---create-a-project",level:3},{value:"Step 2.2 - Add a Bitbucket Connection",id:"step-22---add-a-bitbucket-connection",level:3},{value:"Step 2.3 - Set the Sync Policy",id:"step-23---set-the-sync-policy",level:3},{value:"Step 2.4 - Start Data Collection",id:"step-24---start-data-collection",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2}],c={toc:p};function u(e){let{components:t,...o}=e;return(0,a.kt)("wrapper",(0,n.Z)({},c,o,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Visit Config UI at ",(0,a.kt)("inlineCode",{parentName:"p"},"http://localhost:4000")," and go to the ",(0,a.kt)("inlineCode",{parentName:"p"},"Connections")," page."),(0,a.kt)("h2",{id:"step-1---add-data-connections"},"Step 1 - Add Data Connections"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/3294100/220118398-2d08070f-0edb-4de6-8696-9ee58b80719b.png",alt:"image"})),(0,a.kt)("h3",{id:"step-11---authentication"},"Step 1.1 - Authentication"),(0,a.kt)("h4",{id:"connection-name"},"Connection Name"),(0,a.kt)("p",null,"Give your connection a unique name to help you identify it in the future."),(0,a.kt)("h4",{id:"endpoint-url"},"Endpoint URL"),(0,a.kt)("p",null,"For Bitbucket Cloud, you do not need to enter the REST API endpoint URL, which is always ",(0,a.kt)("inlineCode",{parentName:"p"},"https://api.bitbucket.org/2.0/"),"."),(0,a.kt)("h4",{id:"username-and-app-password"},"Username and App Password"),(0,a.kt)("p",null,"Learn about ",(0,a.kt)("a",{parentName:"p",href:"https://support.atlassian.com/bitbucket-cloud/docs/create-an-app-password/"},"how to create a Bitbucket app password"),"."),(0,a.kt)("p",null,"The following permissions are required to collect data from Bitbucket repositories:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Account:Read"),(0,a.kt)("li",{parentName:"ul"},"Workspace membership:Read"),(0,a.kt)("li",{parentName:"ul"},"Projects:Read"),(0,a.kt)("li",{parentName:"ul"},"Repositories:Read"),(0,a.kt)("li",{parentName:"ul"},"Pull requests:Read"),(0,a.kt)("li",{parentName:"ul"},"Issues:Read"),(0,a.kt)("li",{parentName:"ul"},"Pipelines:Read"),(0,a.kt)("li",{parentName:"ul"},"Runners:Read")),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"bitbucket-app-password-permissions",src:i(44132).Z,width:"1212",height:"830"})),(0,a.kt)("h4",{id:"proxy-url-optional"},"Proxy URL (Optional)"),(0,a.kt)("p",null,"If you are behind a corporate firewall or VPN you may need to utilize a proxy server. Enter a valid proxy server address on your network, e.g. ",(0,a.kt)("inlineCode",{parentName:"p"},"http://your-proxy-server.com:1080")),(0,a.kt)("h4",{id:"fixed-rate-limit-optional"},"Fixed Rate Limit (Optional)"),(0,a.kt)("p",null,"DevLake uses a dynamic rate limit to collect Bitbucket data. You can adjust the rate limit if you want to increase or lower the speed."),(0,a.kt)("p",null,"The maximum rate limit for different entities in Bitbucket(Cloud) ",(0,a.kt)("a",{parentName:"p",href:"https://support.atlassian.com/bitbucket-cloud/docs/api-request-limits/"},"varies from 1,000 - 60,000 requests/hour"),". The rate limit to access repository data is 1,000 requests/hour, but we find it can still run when we input a value that exceeds 1,000. You can try using a larger rate limit if you have large repositories."),(0,a.kt)("h4",{id:"test-and-save-connection"},"Test and Save Connection"),(0,a.kt)("p",null,"Click ",(0,a.kt)("inlineCode",{parentName:"p"},"Test Connection"),", if the connection is successful, click ",(0,a.kt)("inlineCode",{parentName:"p"},"Save Connection")," to add the connection."),(0,a.kt)("h3",{id:"step-12---add-data-scopes"},"Step 1.2 - Add Data Scopes"),(0,a.kt)("p",null,"Choose the Bitbucket repositories you wish to collect either by finding them in the miller column, or searching. You can only add public repositories through the search box."),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/14050754/224308925-449a4d3e-ed52-45e9-bb72-0d2892df374f.png",alt:"image"})),(0,a.kt)("h3",{id:"step-13---add-scope-config-optional"},"Step 1.3 - Add Scope Config (Optional)"),(0,a.kt)("h4",{id:"entities"},"Entities"),(0,a.kt)("p",null,"The entities of which domain you wish to collect: Usually, you don't have to modify this part. However, if you don't want to collect certain Bitbucket entities, you can unselect some entities to accelerate the collection speed."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"- Issue Tracking: Bitbucket issues, issue comments, etc.\n- Source Code Management: Bitbucket repos, refs, commits, etc.\n- Code Review: Bitbucket PRs, PR comments, etc.\n- CI/CD: Bitbucket Pipelines, Bitbucket Deployments, etc.\n- Cross Domain: Bitbucket users, etc.\n")),(0,a.kt)("h4",{id:"transformations"},"Transformations"),(0,a.kt)("p",null,"The transformations on the Bitbucket data you are going to collect."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"The details of the transformations will be explained below."),(0,a.kt)("li",{parentName:"ul"},"Without adding transformation rules, you can still view the 'Bitbucket' dashboard. However, if you want to view more pre-built dashboards, finish the transformations required."),(0,a.kt)("li",{parentName:"ul"},"Each Bitbucket repo has at most ONE set of transformations.")),(0,a.kt)("h6",{id:"issue-tracking--issue-status-mapping"},"Issue Tracking > Issue Status Mapping"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/14050754/224309704-b096c256-b2cf-4107-b78c-044d06b5f23c.png",alt:"image"})),(0,a.kt)("p",null,"The given settings transformed the Bitbucket issue statuses to the issue statuses used by DevLake, enabling you to measure metrics like the Issue Delivery Rate on the pre-built dashboards, as DevLake understands your definition of when an issue is considered as completed (status = 'DONE')."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"TODO: The issues that are planned but have not been worked on yet "),(0,a.kt)("li",{parentName:"ul"},"IN-PROGRESS: The issues that are work-in-progress"),(0,a.kt)("li",{parentName:"ul"},"DONE: The issues that are completed"),(0,a.kt)("li",{parentName:"ul"},"OTHER: Other issues statuses that do not belong to the three statuses above")),(0,a.kt)("p",null,"The original status will be saved in the column ",(0,a.kt)("inlineCode",{parentName:"p"},"original_status")," of the table 'issues', and the new status will be saved in the column ",(0,a.kt)("inlineCode",{parentName:"p"},"status")," of the same table."),(0,a.kt)("h6",{id:"issue-tracking--issue-type-mapping"},"Issue Tracking > Issue Type Mapping"),(0,a.kt)("p",null,"DevLake will convert the issue types of 'enhancement', 'proposal', and 'task' from Bitbucket into the new issue type 'REQUIREMENT' for DevLake. In contrast, any issues classified as 'bug' in Bitbucket will be converted into the new issue type 'BUG' for DevLake. The original type will be saved in the column ",(0,a.kt)("inlineCode",{parentName:"p"},"original_type")," of the table 'issues', and the new type will be saved in the column ",(0,a.kt)("inlineCode",{parentName:"p"},"type")," of the same table."),(0,a.kt)("h6",{id:"cicd"},"CI/CD"),(0,a.kt)("p",null,"The CI/CD configuration for Bitbucket is used for calculating ",(0,a.kt)("a",{parentName:"p",href:"/zh/docs/v1.0/DORA"},"DORA metrics"),"."),(0,a.kt)("p",null,"By default, DevLake will identify the deployment and environment settings that are defined in the Bitbucket CI .yml file. "),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/14050754/224311429-31304867-8cdd-476b-8675-e4acbc17f552.png",alt:"image"})),(0,a.kt)("p",null,"However, to ensure this works properly, you must specify the deployment settings in the .yml file.\n",(0,a.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/3294100/221528908-4943b1e6-1398-49e9-8ce9-aa264995f9bc.jpg",alt:"img_v2_89602d14-a733-4679-9d4b-d9635c03bc5g"})),(0,a.kt)("p",null,"The pipeline steps with the ",(0,a.kt)("inlineCode",{parentName:"p"},"deployment")," key will be recognized as DevLake deployments. The value of the ",(0,a.kt)("inlineCode",{parentName:"p"},"deployment")," key will be recognized as the environment of DevLake deployments."),(0,a.kt)("p",null,"All Bitbucket pipeline steps will be saved in table 'cicd_tasks', but DevLake deployments will be set as ",(0,a.kt)("inlineCode",{parentName:"p"},"type")," = 'deployment' and ",(0,a.kt)("inlineCode",{parentName:"p"},"environment")," = '{Bitbucket-pipeline-step.deployment.value}'."),(0,a.kt)("p",null,"If you have not defined these settings in the .yml file, please select 'Detect Deployments from Pipeline steps in Bitbucket', and input the RegEx in the following fields:"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/14050754/224310350-cc9a4901-476d-4583-ad73-4d3b394bc343.png",alt:"image"})),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Deployment: A pipeline step with a name that matches the given RegEx will be recognized as a DevLake deployment."),(0,a.kt)("li",{parentName:"ul"},"Production: A pipeline step with a name that matches the given RegEx will be recognized as a DevLake cicd_task in the production environment.")),(0,a.kt)("h6",{id:"introduction-to-bitbucket-ci-entities"},"Introduction to Bitbucket CI entities"),(0,a.kt)("p",null,"Bitbucket has several key CI entities: ",(0,a.kt)("inlineCode",{parentName:"p"},"pipelines"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"pipeline steps"),", and ",(0,a.kt)("inlineCode",{parentName:"p"},"deployments"),". A Bitbucket pipeline contains several pipeline steps. Each pipeline step defined with a deployment key can be mapped to a Bitbucket deployment."),(0,a.kt)("p",null,"Each Bitbucket pipeline is converted to a cicd_pipeline in DevLake's domain layer schema and each Bitbucket pipeline step is converted to a cicd_task in DevLake's domain layer.\n",(0,a.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/3294100/220288225-71bee07d-c319-45bd-98e5-f4d01359840e.png",alt:"image"})),(0,a.kt)("p",null,"If a pipeline step defines ",(0,a.kt)("inlineCode",{parentName:"p"},"deployment")," with a value (usually indicating the environment), this pipeline step is also a Bitbucket deployment."),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/3294100/221887426-4cae1c46-31ce-4fcd-b773-a54c28af0264.png",alt:"image"})),(0,a.kt)("h6",{id:"additional-settings-optional"},"Additional Settings (Optional)"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},'Tags Limit: DevLake compares the last N pairs of tags to get the "commit diff\', "issue diff" between tags. N defaults to 10.'),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"commit diff: new commits for a tag relative to the previous one"),(0,a.kt)("li",{parentName:"ul"},"issue diff: issues solved by the new commits for a tag relative to the previous one"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Tags Pattern: Only tags that meet the given Regular Expression will be counted.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},'Tags Order: Only "reverse semver" order is supported for now.'))),(0,a.kt)("p",null,"Please click ",(0,a.kt)("inlineCode",{parentName:"p"},"Save")," to save the transformation rules for the repo. In the data scope list, click ",(0,a.kt)("inlineCode",{parentName:"p"},"Next Step")," to continue configuring."),(0,a.kt)("h2",{id:"step-2---collect-data-in-a-project"},"Step 2 - Collect Data in a Project"),(0,a.kt)("h3",{id:"step-21---create-a-project"},"Step 2.1 - Create a Project"),(0,a.kt)("p",null,"Collecting Bitbucket data requires creating a project first. You can visit the Project page from the side menu and create a new project by following the instructions on the user interface."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"create-a-project",src:i(38516).Z,width:"1624",height:"684"})),(0,a.kt)("h3",{id:"step-22---add-a-bitbucket-connection"},"Step 2.2 - Add a Bitbucket Connection"),(0,a.kt)("p",null,"You can add a previously configured Bitbucket connection to the project and select the boards for which you wish to collect the data for.\nPlease note: if you don't see the repositories you are looking for, please check if you have added them to the connection first."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"add-a-connection",src:i(88749).Z,width:"2394",height:"624"})),(0,a.kt)("h3",{id:"step-23---set-the-sync-policy"},"Step 2.3 - Set the Sync Policy"),(0,a.kt)("p",null,"There are three settings for Sync Policy:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Data Time Range: You can select the time range of the data you wish to collect. The default is set to the past six months."),(0,a.kt)("li",{parentName:"ul"},"Sync Frequency: You can choose how often you would like to sync your data in this step by selecting a sync frequency option or enter a cron code to specify your preferred schedule."),(0,a.kt)("li",{parentName:"ul"},"Skip Failed Tasks: sometime a few tasks may fail in a long pipeline; you can choose to skip them to avoid spending more time in running the pipeline all over again.")),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"sync-policy",src:i(93195).Z,width:"2428",height:"336"})),(0,a.kt)("h3",{id:"step-24---start-data-collection"},"Step 2.4 - Start Data Collection"),(0,a.kt)("p",null,'Click on "Collect Data" to start collecting data for the whole project. You can check the status in the Status tab on the same page.'),(0,a.kt)("h2",{id:"troubleshooting"},"Troubleshooting"),(0,a.kt)("p",null,"If you run into any problems, please check the ",(0,a.kt)("a",{parentName:"p",href:"/zh/docs/v1.0/Troubleshooting/Configuration"},"Troubleshooting")," or ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/apache/incubator-devlake/issues"},"create an issue"),"."))}u.isMDXComponent=!0},44132:(e,t,i)=>{i.d(t,{Z:()=>n});const n=i.p+"assets/images/bitbucket-app-password-permissions-2b87fad376a9ab4a5e4f52b4352d38f1.jpeg"},88749:(e,t,i)=>{i.d(t,{Z:()=>n});const n=i.p+"assets/images/add-a-connection-project-4032e8e9a72cb4a6df81b6ced714205e.png"},38516:(e,t,i)=>{i.d(t,{Z:()=>n});const n=i.p+"assets/images/create-a-project-20e220196044bbf9be564773c45c5990.png"},93195:(e,t,i)=>{i.d(t,{Z:()=>n});const n=i.p+"assets/images/sync-policy-2ac941b2918fc873626375dfe4cbf5f5.png"}}]);