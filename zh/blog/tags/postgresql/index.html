<!doctype html>
<html lang="zh" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-rc.1">
<link rel="alternate" type="application/rss+xml" href="/zh/blog/rss.xml" title="Apache DevLake (Incubating) RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh/blog/atom.xml" title="Apache DevLake (Incubating) Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-PKZLL38MQG"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-PKZLL38MQG",{anonymize_ip:!0})</script><title data-rh="true">1 篇博文 含有标签「postgresql」 | Apache DevLake (Incubating)</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://devlake.apache.org/zh/blog/tags/postgresql"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" property="og:title" content="1 篇博文 含有标签「postgresql」 | Apache DevLake (Incubating)"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/zh/img/logo.svg"><link data-rh="true" rel="canonical" href="https://devlake.apache.org/zh/blog/tags/postgresql"><link data-rh="true" rel="alternate" href="https://devlake.apache.org/blog/tags/postgresql" hreflang="en-GB"><link data-rh="true" rel="alternate" href="https://devlake.apache.org/zh/blog/tags/postgresql" hreflang="zh"><link data-rh="true" rel="alternate" href="https://devlake.apache.org/blog/tags/postgresql" hreflang="x-default"><link rel="stylesheet" href="/zh/assets/css/styles.9d5d795b.css">
<link rel="preload" href="/zh/assets/js/runtime~main.0fd8d91b.js" as="script">
<link rel="preload" href="/zh/assets/js/main.3fbf3886.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">跳到主要内容</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh/"><div class="navbar__logo"><img src="/zh/img/logo.svg" alt="apache-devlake" class="themedImage_ToTc themedImage--light_HNdA"><img src="/zh/img/logo.svg" alt="apache-devlake" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Apache DevLake</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Docs</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh/docs/next/Overview/Introduction">Next</a></li><li><a class="dropdown__link" href="/zh/docs/Overview/Introduction">v0.17 (Stable)</a></li><li><a class="dropdown__link" href="/zh/docs/v0.16/Overview/Introduction">v0.16</a></li><li><a class="dropdown__link" href="/zh/docs/v0.15/Overview/Introduction">v0.15</a></li><li><a class="dropdown__link" href="/zh/docs/v0.14/Overview/Introduction">v0.14</a></li><li><a class="dropdown__link" href="/zh/docs/v0.13/Overview/Introduction">v0.13</a></li><li><a class="dropdown__link" href="/zh/docs/v0.12/Overview/Introduction">v0.12</a></li><li><a class="dropdown__link" href="/zh/docs/v0.11/Overview/Introduction">v0.11</a></li></ul></div><a class="navbar__item navbar__link" href="/zh/livedemo/EngineeringLeads/DORA">Use Cases</a><a class="navbar__item navbar__link" href="/zh/community/">Community</a><a class="navbar__item navbar__link" href="/zh/team">Team</a><a class="navbar__item navbar__link" href="/zh/blogOverview">Blog</a><a href="https://github.com/apache/incubator-devlake" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">ASF</a><ul class="dropdown__menu"><li><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Foundation</a></li><li><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="dropdown__link">License</a></li><li><a href="https://www.apache.org/events/current-event" target="_blank" rel="noopener noreferrer" class="dropdown__link">Events</a></li><li><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Security</a></li><li><a href="https://privacy.apache.org/policies/privacy-policy-public.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Privacy</a></li><li><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Sponsorship</a></li><li><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Thanks</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="最近博文导航"><div class="sidebarItemTitle_pO2u margin-bottom--md">All posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh/blog/compatibility-of-apache-devLake-with-postgreSQL">Compatibility of Apache DevLake with PostgreSQL</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh/blog/how-DevLake-is-up-and-running">How DevLake is Up and Running</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh/blog/apache-welcomes-devlake">Apache Incubator Welcomes DevLake, A Dev-Data Platform Serving Developers</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><header class="margin-bottom--xl"><h1>1 篇博文 含有标签「postgresql」</h1><a href="/zh/blog/tags">查看所有标签</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/zh/blog/compatibility-of-apache-devLake-with-postgreSQL">Compatibility of Apache DevLake with PostgreSQL</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-06-23T00:00:00.000Z" itemprop="datePublished">2022年6月23日</time> · <!-- -->阅读需 3 分钟</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/mindlesscloud" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/8455907?s=400&amp;v=4" alt="ZhangLiang"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/mindlesscloud" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">ZhangLiang</span></a></div><small class="avatar__subtitle" itemprop="description">Apache DevLake PPMC</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Apache DevLake is a dev data platform that can collect and integrate data from different dev tools including Jira, Github, Gitlab and Jenkins.</p><p>This blog will not aim at a comprehensive summary of the compatibility of database but a record of issues for future reference.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1different--data-types">1.Different  Data Types<a class="hash-link" href="#1different--data-types" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="postgresql-does-not-have-a-uint-type">PostgreSQL does not have a uint type<a class="hash-link" href="#postgresql-does-not-have-a-uint-type" title="标题的直接链接">​</a></h3><div class="language-sql= codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql= codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">type JenkinsBuild struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> common.NoPKModel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> JobName           string  `gorm:&quot;primaryKey;type:varchar(255)&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Duration          float64 // build time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> DisplayName       string  // &quot;#7&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> EstimatedDuration float64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Number            int64 `gorm:&quot;primaryKey;type:INT(10) UNSIGNED NOT NULL&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Result            string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Timestamp         int64     // start time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> StartTime         time.Time // convered by timestamp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> CommitSha         string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In <code>JenkinsBuild.Number</code>, the<code>gorm</code>struct tag used <code>UNSIGNED</code>, which will lead to the failure to create table and should be removed.</p><p><img loading="lazy" src="https://i.imgur.com/N7E9Vwd.png" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="mysql-does-not-have-a-bool-data-type">MySQL does not have a bool data type<a class="hash-link" href="#mysql-does-not-have-a-bool-data-type" title="标题的直接链接">​</a></h3><p>For a field defined as bool type in model, gorm will map it to MySQL&#x27;s TINYINT data type, which can be queried directly with 0 or 1 in SQL, but PostgreSQL has a bool type, so gorm will map it to the BOOL type. If 0 or 1 is still used in SQL to query, there will be a report of error.</p><p>Here is an example(only relevant fields are shown in the example). The lookup statement works in MySQL, but will lead to an error in PostgreSQL.</p><div class="language-sql= codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql= codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">type GitlabMergeRequestNote struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> MergeRequestId  int    `gorm:&quot;index&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> System          bool </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db.Where(&quot;merge_request_id = ? AND `system` = 0&quot;, gitlabMr.GitlabId).</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>After changing the sentence as it follows, an error will still be reported. The reason will be shown in the part about backticks.</p><div class="language-sql= codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql= codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">db.Where(&quot;merge_request_id = ? AND `system` = ?&quot;, gitlabMr.GitlabId, false)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2different-behaviors">2.Different Behaviors<a class="hash-link" href="#2different-behaviors" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="bulk-insertion">Bulk insertion<a class="hash-link" href="#bulk-insertion" title="标题的直接链接">​</a></h3><p>When <code>ON CONFLIT UPDATE ALL</code> was used to achieve bulk insertion, and if there are multiple records with the same primary key, it will report errors in PostgreSQL but not in MySQL.
<img loading="lazy" src="https://i.imgur.com/zaExAUG.png" class="img_ev3q"></p><p><img loading="lazy" src="https://i.imgur.com/BpZY8dN.png" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="inconsistent-definition-of-model-with-schema">Inconsistent definition of model with schema<a class="hash-link" href="#inconsistent-definition-of-model-with-schema" title="标题的直接链接">​</a></h3><p>For example, in the model definition, <code>GithubPullRequest.AuthorId</code> is of the int type, but this field in the database is of VARCHAR type. When inserting data, MySQL will accept it, but ProstgresSQL will report an error.</p><div class="language-sql= codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql= codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">type GithubPullRequest struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> GithubId        int    `gorm:&quot;primaryKey&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> RepoId          int    `gorm:&quot;index&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Number          int    `gorm:&quot;index&quot;` </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> State           string `gorm:&quot;type:varchar(255)&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Title           string `gorm:&quot;type:varchar(255)&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> GithubCreatedAt time.Time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> GithubUpdatedAt time.Time `gorm:&quot;index&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ClosedAt        *time.Time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> // In order to get the following fields, we need to collect PRs individually from GitHub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Additions      int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Deletions      int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Comments       int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Commits        int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ReviewComments int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Merged         bool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> MergedAt       *time.Time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Body           string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Type           string `gorm:&quot;type:varchar(255)&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Component      string `gorm:&quot;type:varchar(255)&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> MergeCommitSha string `gorm:&quot;type:varchar(40)&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> HeadRef        string `gorm:&quot;type:varchar(255)&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> BaseRef        string `gorm:&quot;type:varchar(255)&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> BaseCommitSha  string `gorm:&quot;type:varchar(255)&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> HeadCommitSha  string `gorm:&quot;type:varchar(255)&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Url            string `gorm:&quot;type:varchar(255)&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> AuthorName     string `gorm:&quot;type:varchar(100)&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> AuthorId       int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> common.NoPKModel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://i.imgur.com/onxGG8d.png" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="3mysql-specific-functions">3.MySQL-Specific Functions<a class="hash-link" href="#3mysql-specific-functions" title="标题的直接链接">​</a></h2><p>We used the <code>GROUP_CONCAT</code>function in a complex query. Although there are similar functions in PostgreSQL, the function names are different and the usage is slightly different.</p><div class="language-sql= codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql= codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cursor2, err := db.Table(&quot;pull_requests pr1&quot;).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Joins(&quot;left join pull_requests pr2 on pr1.parent_pr_id = pr2.id&quot;).Group(&quot;pr1.parent_pr_id, pr2.created_date&quot;).Where(&quot;pr1.parent_pr_id != &#x27;&#x27;&quot;).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Joins(&quot;left join repos on pr2.base_repo_id = repos.id&quot;).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Order(&quot;pr2.created_date ASC&quot;).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Select(`pr2.key as parent_pr_key, pr1.parent_pr_id as parent_pr_id, GROUP_CONCAT(pr1.base_ref order by pr1.base_ref ASC) as cherrypick_base_branches, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   GROUP_CONCAT(pr1.key order by pr1.base_ref ASC) as cherrypick_pr_keys, repos.name as repo_name, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   concat(repos.url, &#x27;/pull/&#x27;, pr2.key) as parent_pr_url`).Rows()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Solution:
We finally decided to use two steps to achieve the <code>GROUP_CONCAT</code> function. First we used the simplest SQL query to get multiple pieces of the sorted data, and then used the code to group them.</p><p>After modification:</p><div class="language-sql= codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql= codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    cursor2, err := db.Raw(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   SELECT pr2.pull_request_key                 AS parent_pr_key,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          pr1.parent_pr_id                     AS parent_pr_id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          pr1.base_ref                         AS cherrypick_base_branch,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          pr1.pull_request_key                 AS cherrypick_pr_key,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          repos.NAME                           AS repo_name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Concat(repos.url, &#x27;/pull/&#x27;, pr2.pull_request_key) AS parent_pr_url,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pr2.created_date</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   FROM   pull_requests pr1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          LEFT JOIN pull_requests pr2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 ON pr1.parent_pr_id = pr2.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          LEFT JOIN repos</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 ON pr2.base_repo_id = repos.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   WHERE  pr1.parent_pr_id != &#x27;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ORDER  BY pr1.parent_pr_id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             pr2.created_date,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       pr1.base_ref ASC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   `).Rows()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="4different-grammar">4.Different Grammar<a class="hash-link" href="#4different-grammar" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="backticks">Backticks<a class="hash-link" href="#backticks" title="标题的直接链接">​</a></h3><p>We used backticks in some SQL statements to protect field names from conflicting with MySQL reserved words, which can lead to errors in PostgreSQL. To solve this problem we revisited our code, modified all field names that conflict with reserved words, and removed the backticks in the SQL statement. In the example just mentioned:</p><div class="language-sql= codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql= codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">db.Where(&quot;merge_request_id = ? AND `system` = ?&quot;, gitlabMr.GitlabId, false)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Solution:
We changed <code>system</code> to <code>is_system</code> to avoid the usage of backticks.</p><div class="language-sql= codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql= codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">db.Where(&quot;merge_request_id = ? AND is_system = ?&quot;, gitlabMr.GitlabId, false)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="non-standard-delete-statement">Non-standard delete statement<a class="hash-link" href="#non-standard-delete-statement" title="标题的直接链接">​</a></h3><p>There were delete statements as followed in our code, which are legal in MySQL but will report an error in PostgreSQL.</p><div class="language-sql= codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql= codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">err := db.Exec(`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> DELETE ic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> FROM jira_issue_commits ic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> LEFT JOIN jira_board_issues bi ON (bi.source_id = ic.source_id AND bi.issue_id = ic.issue_id)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> WHERE ic.source_id = ? AND bi.board_id = ?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> `, sourceId, boardId).Error</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>标签：</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/zh/blog/tags/devlake">devlake</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/zh/blog/tags/database">database</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/zh/blog/tags/postgresql">postgresql</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="博文列表分页导航"></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/zh/docs/GettingStarted">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/zh/docs/DataModels/DevLakeDomainLayerSchema">Data Models</a></li><li class="footer__item"><a class="footer__link-item" href="/zh/docs/Metrics">Engineering Metrics</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://join.slack.com/t/devlake-io/shared_invite/zt-17b6vuvps-x98pqseoUagM7EAmKC82xQ" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack</a></li><li class="footer__item"><a href="https://github.com/apache/incubator-devlake/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Issue Tracker</a></li><li class="footer__item"><a href="https://github.com/apache/incubator-devlake-website/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Issue Tracker For Docs</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/apache/incubator-devlake" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://twitter.com/ApacheDevLake" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><a class="footer__link-item" href="/zh/community/trademark">Trademark Guidelines</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">
        <div style="margin-top: 20px">
          <a href="https://incubator.apache.org/" target="_blank"><img style="height:40px; margin-bottom: 10px; margin-top: 10px" alt="Apache Software Foundation" src="/img/apache-incubator.svg"></a>
          <p style="text-align:left; font-weight: 300; font-size: 0.8em;">Apache DevLake is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.</p>
          <p style="text-align:left; font-weight: 300; font-size: 0.8em;">Copyright ©2023 Apache DevLake, DevLake, Apache, the Apache feather logo and the Apache DevLake project logo are either registered trademarks or trademarks of The Apache Software Foundation in the United States and other countries.</p>
        </div> 
        </div></div></div></footer></div>
<script src="/zh/assets/js/runtime~main.0fd8d91b.js"></script>
<script src="/zh/assets/js/main.3fbf3886.js"></script>
</body>
</html>