<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper docs-doc-page docs-version-v0.13 plugin-docs plugin-id-default docs-doc-id-DeveloperManuals/PluginImplementation">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-rc.1">
<link rel="alternate" type="application/rss+xml" href="/zh/blog/rss.xml" title="Apache DevLake (Incubating) RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh/blog/atom.xml" title="Apache DevLake (Incubating) Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-PKZLL38MQG"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-PKZLL38MQG",{anonymize_ip:!0})</script><title data-rh="true">Plugin Implementation | Apache DevLake (Incubating)</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://devlake.apache.org/zh/docs/v0.13/DeveloperManuals/PluginImplementation"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="v0.13"><meta data-rh="true" name="docusaurus_tag" content="docs-default-v0.13"><meta data-rh="true" name="docsearch:version" content="v0.13"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-v0.13"><meta data-rh="true" property="og:title" content="Plugin Implementation | Apache DevLake (Incubating)"><meta data-rh="true" name="description" content="Plugin Implementation
"><meta data-rh="true" property="og:description" content="Plugin Implementation
"><link data-rh="true" rel="icon" href="/zh/img/logo.svg"><link data-rh="true" rel="canonical" href="https://devlake.apache.org/zh/docs/v0.13/DeveloperManuals/PluginImplementation"><link data-rh="true" rel="alternate" href="https://devlake.apache.org/docs/v0.13/DeveloperManuals/PluginImplementation" hreflang="en-GB"><link data-rh="true" rel="alternate" href="https://devlake.apache.org/zh/docs/v0.13/DeveloperManuals/PluginImplementation" hreflang="zh"><link data-rh="true" rel="alternate" href="https://devlake.apache.org/docs/v0.13/DeveloperManuals/PluginImplementation" hreflang="x-default"><link rel="stylesheet" href="/zh/assets/css/styles.9d5d795b.css">
<link rel="preload" href="/zh/assets/js/runtime~main.0fd8d91b.js" as="script">
<link rel="preload" href="/zh/assets/js/main.3fbf3886.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">跳到主要内容</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh/"><div class="navbar__logo"><img src="/zh/img/logo.svg" alt="apache-devlake" class="themedImage_ToTc themedImage--light_HNdA"><img src="/zh/img/logo.svg" alt="apache-devlake" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Apache DevLake</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Docs</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh/docs/next/Overview/Introduction">Next</a></li><li><a class="dropdown__link" href="/zh/docs/Overview/Introduction">v0.17 (Stable)</a></li><li><a class="dropdown__link" href="/zh/docs/v0.16/Overview/Introduction">v0.16</a></li><li><a class="dropdown__link" href="/zh/docs/v0.15/Overview/Introduction">v0.15</a></li><li><a class="dropdown__link" href="/zh/docs/v0.14/Overview/Introduction">v0.14</a></li><li><a class="dropdown__link" href="/zh/docs/v0.13/Overview/Introduction">v0.13</a></li><li><a class="dropdown__link" href="/zh/docs/v0.12/Overview/Introduction">v0.12</a></li><li><a class="dropdown__link" href="/zh/docs/v0.11/Overview/Introduction">v0.11</a></li></ul></div><a class="navbar__item navbar__link" href="/zh/livedemo/EngineeringLeads/DORA">Use Cases</a><a class="navbar__item navbar__link" href="/zh/community/">Community</a><a class="navbar__item navbar__link" href="/zh/team">Team</a><a class="navbar__item navbar__link" href="/zh/blogOverview">Blog</a><a href="https://github.com/apache/incubator-devlake" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">ASF</a><ul class="dropdown__menu"><li><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Foundation</a></li><li><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="dropdown__link">License</a></li><li><a href="https://www.apache.org/events/current-event" target="_blank" rel="noopener noreferrer" class="dropdown__link">Events</a></li><li><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Security</a></li><li><a href="https://privacy.apache.org/policies/privacy-policy-public.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Privacy</a></li><li><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Sponsorship</a></li><li><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Thanks</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/zh/docs/v0.13/Overview">Overview</a><button aria-label="打开/收起侧边栏菜单「Overview」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/zh/docs/v0.13/GettingStarted">Getting Started</a><button aria-label="打开/收起侧边栏菜单「Getting Started」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/zh/docs/v0.13/UserManuals">User Manuals</a><button aria-label="打开/收起侧边栏菜单「User Manuals」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/docs/v0.13/SupportedDataSources">Supported Data Sources</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/zh/docs/v0.13/Metrics">Metrics</a><button aria-label="打开/收起侧边栏菜单「Metrics」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/zh/docs/v0.13/DataModels">Data Models</a><button aria-label="打开/收起侧边栏菜单「Data Models」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/docs/v0.13/Glossary">Glossary</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/zh/docs/v0.13/DeveloperManuals">Developer Manuals</a><button aria-label="打开/收起侧边栏菜单「Developer Manuals」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/v0.13/DeveloperManuals/DeveloperSetup">Developer Setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/zh/docs/v0.13/DeveloperManuals/PluginImplementation">Plugin Implementation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/v0.13/DeveloperManuals/DBMigration">DB Migration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/v0.13/DeveloperManuals/Notifications">Notifications</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/v0.13/DeveloperManuals/Dal">Dal</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/v0.13/DeveloperManuals/TagNamingConventions">Tag Naming Conventions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/v0.13/DeveloperManuals/E2E-Test-Guide">E2E Test Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/v0.13/DeveloperManuals/Release-SOP">Devlake release guide</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/zh/docs/v0.13/Plugins">Plugins</a><button aria-label="打开/收起侧边栏菜单「Plugins」" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>此为 <!-- -->Apache DevLake (Incubating)<!-- --> <b>v0.13</b> 版的文档，现已不再积极维护。</div><div class="margin-top--md">最新的文档请参阅 <b><a href="/zh/docs/DeveloperManuals/PluginImplementation">最新版本</a></b> (<!-- -->v0.17<!-- -->)。</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/zh/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/zh/docs/v0.13/DeveloperManuals"><span itemprop="name">Developer Manuals</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Plugin Implementation</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">版本：v0.13</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Plugin Implementation</h1></header><p>If your favorite DevOps tool is not yet supported by DevLake, don&#x27;t worry. It&#x27;s not difficult to implement a DevLake plugin. In this post, we&#x27;ll go through the basics of DevLake plugins and build an example plugin from scratch together.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-a-plugin">What is a plugin?<a class="hash-link" href="#what-is-a-plugin" title="标题的直接链接">​</a></h2><p>A DevLake plugin is a shared library built with Go&#x27;s <code>plugin</code> package that hooks up to DevLake core at run-time.</p><p>A plugin may extend DevLake&#x27;s capability in three ways:</p><ol><li>Integrating with new data sources</li><li>Transforming/enriching existing data</li><li>Exporting DevLake data to other data systems</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-do-plugins-work">How do plugins work?<a class="hash-link" href="#how-do-plugins-work" title="标题的直接链接">​</a></h2><p>A plugin mainly consists of a collection of subtasks that can be executed by DevLake core. For data source plugins, a subtask may be collecting a single entity from the data source (e.g., issues from Jira). Besides the subtasks, there&#x27;re hooks that a plugin can implement to customize its initialization, migration, and more. See below for a list of the most important interfaces:</p><ol><li><a href="https://github.com/apache/incubator-devlake/blob/main/backend/core/plugin/plugin_meta.go" target="_blank" rel="noopener noreferrer">PluginMeta</a> contains the minimal interface that a plugin should implement, with only two functions <ul><li>Description() returns the description of a plugin</li><li>RootPkgPath() returns the root package path of a plugin</li></ul></li><li><a href="https://github.com/apache/incubator-devlake/blob/main/backend/core/plugin/plugin_init.go" target="_blank" rel="noopener noreferrer">PluginInit</a> allows a plugin to customize its initialization</li><li><a href="https://github.com/apache/incubator-devlake/blob/main/backend/core/plugin/plugin_task.go" target="_blank" rel="noopener noreferrer">PluginTask</a> enables a plugin to prepare data prior to subtask execution</li><li><a href="https://github.com/apache/incubator-devlake/blob/main/backend/core/plugin/plugin_api.go" target="_blank" rel="noopener noreferrer">PluginApi</a> lets a plugin exposes some self-defined APIs</li><li><a href="https://github.com/apache/incubator-devlake/blob/main/backend/core/plugin/plugin_migration.go" target="_blank" rel="noopener noreferrer">PluginMigration</a> is where a plugin manages its database migrations </li><li><a href="https://github.com/apache/incubator-devlake/blob/main/backend/core/plugin/plugin_model.go" target="_blank" rel="noopener noreferrer">PluginModel</a> allows other plugins to get the model information of all database tables of the current plugin through the GetTablesInfo() method.If you need to access Domain Layer Models,please visit <a href="https://devlake.apache.org/docs/DataModels/DevLakeDomainLayerSchema/" target="_blank" rel="noopener noreferrer">DomainLayerSchema</a></li></ol><p>The diagram below shows the control flow of executing a plugin:</p><div class="mermaid" data-mermaid-src="flowchart TD;
    subgraph S4[Step4 sub-task extractor running process];
    direction LR;
    D4[DevLake];
    D4 -- &quot;Step4.1 create a new\n ApiExtractor\n and execute it&quot; --&gt; E[&quot;ExtractXXXMeta.\nEntryPoint&quot;];
    E &lt;-- &quot;Step4.2 read from\n raw table&quot; --&gt; E2[&quot;RawDataSubTaskArgs\n.Table&quot;];
    E -- &quot;Step4.3 call with RawData&quot; --&gt; ApiExtractor.Extract;
    ApiExtractor.Extract -- &quot;decode and return gorm models&quot; --&gt; E
    end
    subgraph S3[Step3 sub-task collector running process]
    direction LR
    D3[DevLake]
    D3 -- &quot;Step3.1 create a new\n ApiCollector\n and execute it&quot; --&gt; C[&quot;CollectXXXMeta.\nEntryPoint&quot;];
    C &lt;-- &quot;Step3.2 create\n raw table&quot; --&gt; C2[&quot;RawDataSubTaskArgs\n.RAW_BBB_TABLE&quot;];
    C &lt;-- &quot;Step3.3 build query\n before sending requests&quot; --&gt; ApiCollectorArgs.\nQuery/UrlTemplate;
    C &lt;-. &quot;Step3.4 send requests by ApiClient \n and return HTTP response&quot; .-&gt; A1[&quot;HTTP APIs&quot;];
    C &lt;-- &quot;Step3.5 call and \nreturn decoded data \nfrom HTTP response&quot; --&gt; ResponseParser;
    end
    subgraph S2[Step2 DevLake register custom plugin]
    direction LR
    D2[DevLake]
    D2 &lt;-- &quot;Step2.1 function \`Init\` \nneed to do init jobs&quot; --&gt; plugin.Init;
    D2 &lt;-- &quot;Step2.2 (Optional) call \nand return migration scripts&quot; --&gt; plugin.MigrationScripts;
    D2 &lt;-- &quot;Step2.3 (Optional) call \nand return taskCtx&quot; --&gt; plugin.PrepareTaskData;
    D2 &lt;-- &quot;Step2.4 call and \nreturn subTasks for execting&quot; --&gt; plugin.SubTaskContext;
    end
    subgraph S1[Step1 Run DevLake]
    direction LR
    main -- &quot;Transfer of control \nby \`runner.DirectRun\`&quot; --&gt; D1[DevLake];
    end
    S1--&gt;S2--&gt;S3--&gt;S4">flowchart TD;
    subgraph S4[Step4 sub-task extractor running process];
    direction LR;
    D4[DevLake];
    D4 -- &quot;Step4.1 create a new\n ApiExtractor\n and execute it&quot; --&gt; E[&quot;ExtractXXXMeta.\nEntryPoint&quot;];
    E &lt;-- &quot;Step4.2 read from\n raw table&quot; --&gt; E2[&quot;RawDataSubTaskArgs\n.Table&quot;];
    E -- &quot;Step4.3 call with RawData&quot; --&gt; ApiExtractor.Extract;
    ApiExtractor.Extract -- &quot;decode and return gorm models&quot; --&gt; E
    end
    subgraph S3[Step3 sub-task collector running process]
    direction LR
    D3[DevLake]
    D3 -- &quot;Step3.1 create a new\n ApiCollector\n and execute it&quot; --&gt; C[&quot;CollectXXXMeta.\nEntryPoint&quot;];
    C &lt;-- &quot;Step3.2 create\n raw table&quot; --&gt; C2[&quot;RawDataSubTaskArgs\n.RAW_BBB_TABLE&quot;];
    C &lt;-- &quot;Step3.3 build query\n before sending requests&quot; --&gt; ApiCollectorArgs.\nQuery/UrlTemplate;
    C &lt;-. &quot;Step3.4 send requests by ApiClient \n and return HTTP response&quot; .-&gt; A1[&quot;HTTP APIs&quot;];
    C &lt;-- &quot;Step3.5 call and \nreturn decoded data \nfrom HTTP response&quot; --&gt; ResponseParser;
    end
    subgraph S2[Step2 DevLake register custom plugin]
    direction LR
    D2[DevLake]
    D2 &lt;-- &quot;Step2.1 function \`Init\` \nneed to do init jobs&quot; --&gt; plugin.Init;
    D2 &lt;-- &quot;Step2.2 (Optional) call \nand return migration scripts&quot; --&gt; plugin.MigrationScripts;
    D2 &lt;-- &quot;Step2.3 (Optional) call \nand return taskCtx&quot; --&gt; plugin.PrepareTaskData;
    D2 &lt;-- &quot;Step2.4 call and \nreturn subTasks for execting&quot; --&gt; plugin.SubTaskContext;
    end
    subgraph S1[Step1 Run DevLake]
    direction LR
    main -- &quot;Transfer of control \nby \`runner.DirectRun\`&quot; --&gt; D1[DevLake];
    end
    S1--&gt;S2--&gt;S3--&gt;S4</div><p>There&#x27;s a lot of information in the diagram but we don&#x27;t expect you to digest it right away, simply use it as a reference when you go through the example below.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="a-step-by-step-guide-towards-your-first-plugin">A step-by-step guide towards your first plugin<a class="hash-link" href="#a-step-by-step-guide-towards-your-first-plugin" title="标题的直接链接">​</a></h2><p>In this section, we will describe how to create a data collection plugin from scratch. The data to be collected is the information about all Committers and Contributors of the Apache project, in order to check whether they have signed the CLA. We are going to</p><ul><li>request <code>https://people.apache.org/public/icla-info.json</code> to get the Committers&#x27; information</li><li>request the <code>mailing list</code> to get the Contributors&#x27; information</li></ul><p>We will focus on demonstrating how to request and cache information about all Committers through the Apache API and extract structured data from it. The collection of Contributors will only be briefly described.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-1-bootstrap-the-new-plugin">Step 1: Bootstrap the new plugin<a class="hash-link" href="#step-1-bootstrap-the-new-plugin" title="标题的直接链接">​</a></h3><p><strong>Note:</strong> Please make sure you have DevLake up and running before proceeding.</p><blockquote><p>More info about plugin:
Generally, we need these folders in plugin folders: <code>api</code>, <code>models</code> and <code>tasks</code>
<code>api</code> interacts with <code>config-ui</code> for test/get/save connection of data source</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  - connection [example](https://github.com/apache/incubator-devlake/blob/main/plugins/gitlab/api/connection.go)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - connection model [example](https://github.com/apache/incubator-devlake/blob/main/plugins/gitlab/models/connection.go)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>models</code> stores all <code>data entities</code> and <code>data migration scripts</code>. </p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  - entity </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - data migrations [template](https://github.com/apache/incubator-devlake/tree/main/generator/template/migrationscripts)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>tasks</code> contains all of our <code>sub tasks</code> for a plugin</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  - task data [template](https://github.com/apache/incubator-devlake/blob/main/generator/template/plugin/tasks/task_data.go-template)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - api client [template](https://github.com/apache/incubator-devlake/blob/main/generator/template/plugin/tasks/task_data_with_api_client.go-template)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></blockquote><p>Don&#x27;t worry if you cannot figure out what these concepts mean immediately. We&#x27;ll explain them one by one later. </p><p>DevLake provides a generator to create a plugin conveniently. Let&#x27;s scaffold our new plugin by running <code>go run generator/main.go create-plugin icla</code>, which would ask for <code>with_api_client</code> and <code>Endpoint</code>.</p><ul><li><code>with_api_client</code> is used for choosing if we need to request HTTP APIs by api_client. </li><li><code>Endpoint</code> use in which site we will request, in our case, it should be <code>https://people.apache.org/</code>.</li></ul><p><img loading="lazy" src="https://i.imgur.com/itzlFg7.png" class="img_ev3q"></p><p>Now we have three files in our plugin. <code>api_client.go</code> and <code>task_data.go</code> are in subfolder <code>tasks/</code>.
<img loading="lazy" src="https://i.imgur.com/zon5waf.png" alt="plugin files" class="img_ev3q"></p><p>Have a try to run this plugin by function <code>main</code> in <code>plugin_main.go</code>. When you see result like this:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$go run plugins/icla/plugin_main.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-06-02 18:07:30]  INFO failed to create dir logs: mkdir logs: file exists</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">press `c` to send cancel signal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-06-02 18:07:30]  INFO  [icla] start plugin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">invalid ICLA_TOKEN, but ignore this error now</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-06-02 18:07:30]  INFO  [icla] scheduler for api https://people.apache.org/ worker: 25, request: 18000, duration: 1h0m0s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-06-02 18:07:30]  INFO  [icla] total step: 0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>How exciting. It works! The plugin defined and initiated in <code>plugin_main.go</code> use some options in <code>task_data.go</code>. They are made up as the most straightforward plugin in Apache DevLake, and <code>api_client.go</code> will be used in the next step to request HTTP APIs.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-2-create-a-sub-task-for-data-collection">Step 2: Create a sub-task for data collection<a class="hash-link" href="#step-2-create-a-sub-task-for-data-collection" title="标题的直接链接">​</a></h3><p>Before we start, it is helpful to know how collection task is executed: </p><ol><li>First, Apache DevLake would call <code>plugin_main.PrepareTaskData()</code> to prepare needed data before any sub-tasks. We need to create an API client here.</li><li>Then Apache DevLake will call the sub-tasks returned by <code>plugin_main.SubTaskMetas()</code>. Sub-task is an independent task to do some job, like requesting API, processing data, etc.</li></ol><blockquote><p>Each sub-task must be defined as a SubTaskMeta, and implement SubTaskEntryPoint of SubTaskMeta. SubTaskEntryPoint is defined as </p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> SubTaskEntryPoint </span><span class="token keyword" style="color:#00009f">func</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c SubTaskContext</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token builtin">error</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>More info at: <a href="https://devlake.apache.org/blog/how-DevLake-is-up-and-running/" target="_blank" rel="noopener noreferrer">https://devlake.apache.org/blog/how-DevLake-is-up-and-running/</a></p></blockquote><h4 class="anchor anchorWithStickyNavbar_LWe7" id="step-21-create-a-sub-taskcollector-for-data-collection">Step 2.1: Create a sub-task(Collector) for data collection<a class="hash-link" href="#step-21-create-a-sub-taskcollector-for-data-collection" title="标题的直接链接">​</a></h4><p>Let&#x27;s run <code>go run generator/main.go create-collector icla committer</code> and confirm it. This sub-task is activated by registering in <code>plugin_main.go/SubTaskMetas</code> automatically.</p><p><img loading="lazy" src="https://i.imgur.com/tkDuofi.png" class="img_ev3q"></p><blockquote><ul><li>Collector will collect data from HTTP or other data sources, and save the data into the raw layer. </li><li>Inside the func <code>SubTaskEntryPoint</code> of <code>Collector</code>, we use <code>helper.NewApiCollector</code> to create an object of <a href="https://github.com/apache/incubator-devlake/blob/main/backend/generator/template/plugin/tasks/api_collector.go-template" target="_blank" rel="noopener noreferrer">ApiCollector</a>, then call <code>execute()</code> to do the job. </li></ul></blockquote><p>Now you can notice <code>data.ApiClient</code> is initiated in <code>plugin_main.go/PrepareTaskData.ApiClient</code>. <code>PrepareTaskData</code> create a new <code>ApiClient</code>, which is a tool Apache DevLake suggests to request data from HTTP Apis. This tool support some valuable features for HttpApi, like rateLimit, proxy and retry. Of course, if you like, you may use the lib <code>http</code> instead, but it will be more tedious.</p><p>Let&#x27;s move forward to use it.</p><ol><li>To collect data from <code>https://people.apache.org/public/icla-info.json</code>,
we have filled <code>https://people.apache.org/</code> into <code>tasks/api_client.go/ENDPOINT</code> in Step 1.</li></ol><p><img loading="lazy" src="https://i.imgur.com/q8Zltnl.png" class="img_ev3q"></p><ol start="2"><li>Fill <code>public/icla-info.json</code> into <code>UrlTemplate</code>, delete the unnecessary iterator and add <code>println(&quot;receive data:&quot;, res)</code> in <code>ResponseParser</code> to see if collection was successful.</li></ol><p><img loading="lazy" src="https://i.imgur.com/ToLMclH.png" class="img_ev3q"></p><p>Ok, now the collector sub-task has been added to the plugin, and we can kick it off by running <code>main</code> again. If everything goes smoothly, the output should look like this:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-06-06 </span><span class="token number" style="color:#36acaa">12</span><span class="token plain">:24:52</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  INFO  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">icla</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> start plugin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">invalid ICLA_TOKEN, but ignore this error now</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-06-06 </span><span class="token number" style="color:#36acaa">12</span><span class="token plain">:24:52</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  INFO  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">icla</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> scheduler </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> api https://people.apache.org/ worker: </span><span class="token number" style="color:#36acaa">25</span><span class="token plain">, request: </span><span class="token number" style="color:#36acaa">18000</span><span class="token plain">, duration: 1h0m0s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-06-06 </span><span class="token number" style="color:#36acaa">12</span><span class="token plain">:24:52</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  INFO  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">icla</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> total step: </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-06-06 </span><span class="token number" style="color:#36acaa">12</span><span class="token plain">:24:52</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  INFO  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">icla</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> executing subtask CollectCommitter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-06-06 </span><span class="token number" style="color:#36acaa">12</span><span class="token plain">:24:52</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  INFO  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">icla</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">CollectCommitter</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> start api collection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">receive data: 0x140005763f0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-06-06 </span><span class="token number" style="color:#36acaa">12</span><span class="token plain">:24:55</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  INFO  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">icla</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">CollectCommitter</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> finished records: </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-06-06 </span><span class="token number" style="color:#36acaa">12</span><span class="token plain">:24:55</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  INFO  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">icla</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">CollectCommitter</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> end api collection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-06-06 </span><span class="token number" style="color:#36acaa">12</span><span class="token plain">:24:55</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  INFO  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">icla</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> finished step: </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> / </span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Great! Now we can see data pulled from the server without any problem. The last step is to decode the response body in <code>ResponseParser</code> and return it to the framework, so it can be stored in the database.</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ResponseParser</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">func</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">res </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">http</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Response</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">json</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">RawMessage</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    body </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        LastUpdated </span><span class="token builtin">string</span><span class="token plain">          </span><span class="token string" style="color:#e3116c">`json:&quot;last_updated&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Committers  json</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">RawMessage </span><span class="token string" style="color:#e3116c">`json:&quot;committers&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> helper</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">UnmarshalResponse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">res</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> body</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;receive data:&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">body</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Committers</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">json</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">RawMessage</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">body</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Committers</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Ok, run the function <code>main</code> once again, then it turned out like this, and we should be able see some records show up in the table <code>_raw_icla_committer</code>.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">……</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">receive data: </span><span class="token number" style="color:#36acaa">272956</span><span class="token plain"> /* </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">- the number means </span><span class="token number" style="color:#36acaa">272956</span><span class="token plain"> models received */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-06-06 </span><span class="token number" style="color:#36acaa">13</span><span class="token plain">:46:57</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  INFO  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">icla</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">CollectCommitter</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> finished records: </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-06-06 </span><span class="token number" style="color:#36acaa">13</span><span class="token plain">:46:57</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  INFO  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">icla</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">CollectCommitter</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> end api collection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">-06-06 </span><span class="token number" style="color:#36acaa">13</span><span class="token plain">:46:57</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  INFO  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">icla</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> finished step: </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> / </span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://i.imgur.com/aVYNMRr.png" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="step-22-create-a-sub-taskextractor-to-extract-data-from-the-raw-layer">Step 2.2: Create a sub-task(Extractor) to extract data from the raw layer<a class="hash-link" href="#step-22-create-a-sub-taskextractor-to-extract-data-from-the-raw-layer" title="标题的直接链接">​</a></h4><blockquote><ul><li>Extractor will extract data from raw layer and save it into tool db table.</li><li>Except for some pre-processing, the main flow is similar to the collector.</li></ul></blockquote><p>We have already collected data from HTTP API and saved them into the DB table <code>_raw_XXXX</code>. In this step, we will extract the names of committers from the raw data. As you may infer from the name, raw tables are temporary and not easy to use directly.</p><p>Now Apache DevLake suggests to save data by <a href="https://gorm.io/docs/index.html" target="_blank" rel="noopener noreferrer">gorm</a>, so we will create a model by gorm and add it into <code>plugin_main.go/AutoMigrate()</code>.</p><p>plugins/icla/models/committer.go</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">package</span><span class="token plain"> models</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;github.com/apache/incubator-devlake/models/common&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> IclaCommitter </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    UserName     </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">`gorm:&quot;primaryKey;type:varchar(255)&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Name         </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">`gorm:&quot;primaryKey;type:varchar(255)&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    common</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">NoPKModel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">IclaCommitter</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">TableName</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;_tool_icla_committer&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>plugins/icla/plugin_main.go
<img loading="lazy" src="https://i.imgur.com/4f0zJty.png" class="img_ev3q"></p><p>Ok, run the plugin, and table <code>_tool_icla_committer</code> will be created automatically just like the snapshot below:
<img loading="lazy" src="https://i.imgur.com/7Z324IX.png" class="img_ev3q"></p><p>Next, let&#x27;s run <code>go run generator/main.go create-extractor icla committer</code> and type in what the command prompt asks for to create a new sub-task.</p><p><img loading="lazy" src="https://i.imgur.com/UyDP9Um.png" class="img_ev3q"></p><p>Let&#x27;s look at the function <code>extract</code> in <code>committer_extractor.go</code> created just now, and the code that needs to be written here. It&#x27;s obvious that <code>resData.data</code> is the raw data, so we could json-decode each row add a new <code>IclaCommitter</code> for each and save them.</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Extract</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">func</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">resData </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">helper</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">RawData</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token keyword" style="color:#00009f">interface</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    names </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">map</span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">]</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> json</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Unmarshal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">resData</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> names</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    extractedModels </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">make</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token keyword" style="color:#00009f">interface</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> userName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">range</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">names </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        extractedModels </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">extractedModels</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">models</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">IclaCommitter</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            UserName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> userName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">     name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">fco</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> extractedModels</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Ok, run it then we get:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[2022-06-06 15:39:40]  INFO  [icla] start plugin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">invalid ICLA_TOKEN, but ignore this error now</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-06-06 15:39:40]  INFO  [icla] scheduler for api https://people.apache.org/ worker: 25, request: 18000, duration: 1h0m0s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-06-06 15:39:40]  INFO  [icla] total step: 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-06-06 15:39:40]  INFO  [icla] executing subtask CollectCommitter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-06-06 15:39:40]  INFO  [icla] [CollectCommitter] start api collection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">receive data: 272956</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-06-06 15:39:44]  INFO  [icla] [CollectCommitter] finished records: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-06-06 15:39:44]  INFO  [icla] [CollectCommitter] end api collection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-06-06 15:39:44]  INFO  [icla] finished step: 1 / 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-06-06 15:39:44]  INFO  [icla] executing subtask ExtractCommitter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-06-06 15:39:46]  INFO  [icla] [ExtractCommitter] finished records: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-06-06 15:39:46]  INFO  [icla] finished step: 2 / 2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now committer data have been saved in _tool_icla_committer.
<img loading="lazy" src="https://i.imgur.com/6svX0N2.png" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="step-23-convertor">Step 2.3: Convertor<a class="hash-link" href="#step-23-convertor" title="标题的直接链接">​</a></h4><p>Notes: The goal of Converters is to create a vendor-agnostic model out of the vendor-dependent ones created by the Extractors.
They are not necessary to have per se, but we encourage it because converters and the domain layer will significantly help with building dashboards. More info about the domain layer <a href="https://devlake.apache.org/docs/DataModels/DevLakeDomainLayerSchema/" target="_blank" rel="noopener noreferrer">here</a>.</p><p>In short:</p><blockquote><ul><li>Convertor will convert data from the tool layer and save it into the domain layer.</li><li>We use <code>helper.NewDataConverter</code> to create an object of DataConvertor, then call <code>execute()</code>. </li></ul></blockquote><h4 class="anchor anchorWithStickyNavbar_LWe7" id="step-24-lets-try-it">Step 2.4: Let&#x27;s try it<a class="hash-link" href="#step-24-lets-try-it" title="标题的直接链接">​</a></h4><p>Sometimes OpenApi will be protected by token or other auth types, and we need to log in to gain a token to visit it. For example, only after logging in <code>private@apahce.com</code> could we gather the data about contributors signing ICLA. Here we briefly introduce how to authorize DevLake to collect data.</p><p>Let&#x27;s look at <code>api_client.go</code>. <code>NewIclaApiClient</code> load config <code>ICLA_TOKEN</code> by <code>.env</code>, so we can add <code>ICLA_TOKEN=XXXXXX</code> in <code>.env</code> and use it in <code>apiClient.SetHeaders()</code> to mock the login status. Code as below:
<img loading="lazy" src="https://i.imgur.com/dPxooAx.png" class="img_ev3q"></p><p>Of course, we can use <code>username/password</code> to get a token after login mockery. Just try and adjust according to the actual situation.</p><p>Look for more related details at <a href="https://github.com/apache/incubator-devlake" target="_blank" rel="noopener noreferrer">https://github.com/apache/incubator-devlake</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="step-25-implement-the-gettablesinfo-method-of-the-pluginmodel-interface">Step 2.5: Implement the GetTablesInfo() method of the PluginModel interface<a class="hash-link" href="#step-25-implement-the-gettablesinfo-method-of-the-pluginmodel-interface" title="标题的直接链接">​</a></h4><p>As shown in the following gitlab plugin example,
add all models that need to be accessed by external plugins to the return value.</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">_</span><span class="token plain"> core</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">PluginModel </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">Gitlab</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">nil</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">plugin Gitlab</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">GetTablesInfo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">core</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Tabler </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">core</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Tabler</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">models</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">GitlabConnection</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">models</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">GitlabAccount</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">models</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">GitlabCommit</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">models</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">GitlabIssue</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">models</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">GitlabIssueLabel</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">models</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">GitlabJob</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">models</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">GitlabMergeRequest</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">models</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">GitlabMrComment</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">models</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">GitlabMrCommit</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">models</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">GitlabMrLabel</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">models</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">GitlabMrNote</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">models</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">GitlabPipeline</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">models</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">GitlabProject</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">models</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">GitlabProjectCommit</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">models</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">GitlabReviewer</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">models</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">GitlabTag</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can use it as follows:</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> pm</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ok </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> plugin</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">core</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">PluginModel</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> ok </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tables </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> pm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetTablesInfo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">_</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> table </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">range</span><span class="token plain"> tables </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// do something</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="final-step-submit-the-code-as-open-source-code">Final step: Submit the code as open source code<a class="hash-link" href="#final-step-submit-the-code-as-open-source-code" title="标题的直接链接">​</a></h4><p>We encourage ideas and contributions ~ Let&#x27;s use migration scripts, domain layers and other discussed concepts to write normative and platform-neutral code. More info at <a href="https://devlake.apache.org/docs/DataModels/DevLakeDomainLayerSchema" target="_blank" rel="noopener noreferrer">here</a> or contact us for ebullient help.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="done">Done!<a class="hash-link" href="#done" title="标题的直接链接">​</a></h2><p>Congratulations! The first plugin has been created! 🎖</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/apache/incubator-devlake-website/edit/main/versioned_docs/version-v0.13/DeveloperManuals/PluginImplementation.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/zh/docs/v0.13/DeveloperManuals/DeveloperSetup"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Developer Setup</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/zh/docs/v0.13/DeveloperManuals/DBMigration"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">DB Migration</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#what-is-a-plugin" class="table-of-contents__link toc-highlight">What is a plugin?</a></li><li><a href="#how-do-plugins-work" class="table-of-contents__link toc-highlight">How do plugins work?</a></li><li><a href="#a-step-by-step-guide-towards-your-first-plugin" class="table-of-contents__link toc-highlight">A step-by-step guide towards your first plugin</a><ul><li><a href="#step-1-bootstrap-the-new-plugin" class="table-of-contents__link toc-highlight">Step 1: Bootstrap the new plugin</a></li><li><a href="#step-2-create-a-sub-task-for-data-collection" class="table-of-contents__link toc-highlight">Step 2: Create a sub-task for data collection</a></li></ul></li><li><a href="#done" class="table-of-contents__link toc-highlight">Done!</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/zh/docs/GettingStarted">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/zh/docs/DataModels/DevLakeDomainLayerSchema">Data Models</a></li><li class="footer__item"><a class="footer__link-item" href="/zh/docs/Metrics">Engineering Metrics</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://join.slack.com/t/devlake-io/shared_invite/zt-17b6vuvps-x98pqseoUagM7EAmKC82xQ" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack</a></li><li class="footer__item"><a href="https://github.com/apache/incubator-devlake/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Issue Tracker</a></li><li class="footer__item"><a href="https://github.com/apache/incubator-devlake-website/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Issue Tracker For Docs</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/apache/incubator-devlake" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://twitter.com/ApacheDevLake" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><a class="footer__link-item" href="/zh/community/trademark">Trademark Guidelines</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">
        <div style="margin-top: 20px">
          <a href="https://incubator.apache.org/" target="_blank"><img style="height:40px; margin-bottom: 10px; margin-top: 10px" alt="Apache Software Foundation" src="/img/apache-incubator.svg"></a>
          <p style="text-align:left; font-weight: 300; font-size: 0.8em;">Apache DevLake is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.</p>
          <p style="text-align:left; font-weight: 300; font-size: 0.8em;">Copyright ©2023 Apache DevLake, DevLake, Apache, the Apache feather logo and the Apache DevLake project logo are either registered trademarks or trademarks of The Apache Software Foundation in the United States and other countries.</p>
        </div> 
        </div></div></div></footer></div>
<script src="/zh/assets/js/runtime~main.0fd8d91b.js"></script>
<script src="/zh/assets/js/main.3fbf3886.js"></script>
</body>
</html>